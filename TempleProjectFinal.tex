\documentclass[twoside,twocolumn]{article}
\usepackage{blindtext}
\usepackage{amsmath}
\DeclareMathOperator*{\minimize}{minimize}
%\usepackage[T1]{fontenc}
\usepackage{microtype}
\usepackage[english]{babel}
\usepackage[hmarginratio=1:1,top=32mm,columnsep=20pt]{geometry}
\usepackage[hang, small,labelfont=bf,up,textfont=it,up]{caption}
\usepackage{booktabs}
\usepackage{lettrine}
\usepackage{enumitem}
\setlist[itemize]{noitemsep}
\usepackage{abstract}
\renewcommand{\abstractnamefont}{\normalfont\bfseries}
\renewcommand{\abstracttextfont}{\normalfont\small\itshape}
\usepackage{titlesec}
\renewcommand\thesection{\Roman{section}}
\renewcommand\thesubsection{\roman{subsection}}
\titleformat{\section}[block]{\large\scshape\centering}{\thesection.}{1em}{}
\titleformat{\subsection}[block]{\large}{\thesubsection.}{1em}{}
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhead{}
\fancyfoot{}
\fancyhead[C]{ FACILITY LOCATION USING MARKOV CHAINS $\bullet$ OCT 2017}
\fancyfoot[RO,LE]{\thepage}
\usepackage{titling}
\usepackage{hyperref}
\usepackage{tikz}
\usetikzlibrary{arrows}
\usepackage{graphicx}
\usepackage{amssymb}

\setlength{\droptitle}{-4\baselineskip}
\pretitle{\begin{center}\Huge\bfseries}
\posttitle{\end{center}}
\title{Facility Location Using Markov Chains}
\author{
\textsc{Applied Mathematical Modeling Research Team}\\[1ex]
\normalsize Brigham Young University \\
\normalsize \href{mailto:amm@math.byu.edu}{amm@math.byu.edu}
}
\date{\today}
\renewcommand{\maketitlehookd}{
\begin{abstract}
\noindent We consider using Markov chains to solve facility location problems.
In particular, we find a Markov chain when coupled with realistic assumptions about a consumer-supplier network is able to answer questions such as: Where should a facility be placed to have the most consumer throughput, or so that the most neglected customers can have increased ability to access it?
We present an example construction including computational results for finding the best location in the United States for a new temple to be built by a national church.
\end{abstract}
}

% General Suggestions from Dr. Jarvis:
%   - Use active voice wherever possible.
%   - Standardize citation method, put years next to the authors' names.
%   - Advertise for our methods --> hearken back to the new things that we're doing as often as possible.
%   - Standardize the language. (producer/consumer or something)
%   - Remember that our audience wants to solve a problem, not do math.

\begin{document}
\maketitle

\section{Introduction}

Problems in location theory, such as the facility location problem, are formulated to maximize the amount of satisfied demand by finding optimal locations for facilities, either through adding new facilities or relocating existing ones.
There are a myriad of ways to define an optimal location, but the standard definition is a location that minimizes the average distance traveled to fulfill a demand (Owen \& Daskin, 1998).
Additional definitions of optimal include the location that minimizes the maximum distance to fulfill a demand, the location to maximize throughput in all producer centers, or the location that minimizes the average time for consumers to travel to producer centers. %Awkward terminology
In this paper, we show that a Markov chain can facilitate the study and understanding of these other definitions of optimal, as well as solve facility location problems using these other definitions.

One of the simplest and most prominent facility location problems optimizing on distance is the $P$-median problem, which tries to minimize the distance that a demand must travel to reach its nearest facility (Current, Min, \& Schilling, 1990). %repetitive
Typical applications of $P$-median problems include finding optimal locations for industrial warehouses to minimize shipping distances (Jakubovskis, 2017), stores to maximize availability to customers (Klose, Drexl, 2005), and emergency response public services where response time is imperative (Ghosh, Gosavi, 2017).
As a special case of the $P$-median problem, we will be contrasting our analysis with the Fermat-Weber problem (Bose, Maheshwari, Morin, 2003). 
For notational convenience, we call the method associated with the Fermat-Weber problem the Weighted-Distance Model (WDM). %probably not a model in the rigorous sense
This method considers the Euclidean length of the paths between the demands and the potential facility, but these paths can be manually adjusted individually to account for advantages or disadvantages in the path. %Change euclidean - direct distance?
An example of this model in application can be found in the paper by Ndiaye, Ndiaye and Ly (2012). %Describe paper?

In comparison to the WDM, the main approach employed in this paper is to use a Markov chain to model the behavior of consumers as they interact with facilities. 
An interaction could be a sale made, a visit to a retail location, or any other meaningful experience that a consumer would have with a producer.
The model does not require each interaction to be of the same type.
Markov chains reveal the effects that simple local behaviors have on more complex global behaviors through modeling the behavior as a network. %Maybe end before "through..."
This is similar to the goal of many facility location problems, as it is often the case that the behavior being optimized is about the aggregate populous and not the specific actions of certain individuals.
Markov chains have been used in many applications, including: mathematical ecology (Kirkland, 2014), computational biology (Krogh, Brown, Mian, Sjolander, Haussler, 1994), and network modeling (Newman, 2003). %transition needed
But they have not been commonly used in facility location problems. %fragment
In this paper, we seek to show that Markov chains provide a robust, flexible, and efficient way to model facility location problems and they offer additional information not found in the standard analysis of the $P$-median problem.

The rest of the paper is outlined as follows.
Section 2 contains a literary review of facility location problems that Markov models could potentially be used on, the Euclidean distance model and the Markov model. %change euclidean
Section 3 will outline the construction of the Markov transition matrix used to solve facility location problems, give the results of the general testing of the model and expand on insights gained while studying the model.
Section 4 expounds on the set up and results of using our model to determine new locations for temples of The Church of Jesus Christ of Latter-Day Saints (LDS church).
Section 5 will conclude the paper with suggestions for further work.

\section{Literature Review}

Facility location management is a well-established area within operations research. %obvious
Current, Min and Schilling report that facility location management has been researched through the perspective of many different academic disciplines and cite a recent bibliography on this subject that had over 1500 titles, showing the vast expanse of research in this area (1990). %it's great they cite it, should we cite it directly?
Owen and Daskin, in their literature review, give an overview of the most-used models among this immense amount of literature.
They comment on 15 differing subsets of facility location problems, again demonstrating the vastness of the literature and applicability of the problem (1998).
Although the library of facility location management is large, this review focuses primarily on literature pertaining to median problems, with a specific emphasis on the use of Markov chain models. %model?  This seems like we want to talk about the use of markov chains in facility location management, which they aren't really.

The study of location theory began in 1909 when Alfred Weber was researching possible warehouse location based on the average distance to be traveled by those who would visit the warehouse (Owen \& Daskin, 1998).
His research created the basis for {\em median problems}, or problems that determine a facility location by minimizing the average distance traveled by consumers.
This distance is often weighted using factors like speed limits, traffic, proximity to competitors, and tolls. %citation needed
As noted by Melo, Nickel and Saldanha-da-Gamma, the $P$-median problem is considered to be the foundational median problem.
They define the $P$-median problem as the problem of placing $P$ facilities in locations that minimize the total weighted distance (or costs) to satisfy customer demands (2009).

From this rudimentary definition of a $P$-median problem arises a multitude of slight variations that account for the context of the problem.
For example, Berman, Drezner, and Wesolowsky use a model formulation which allows demands to be serviced by facilities other than the one closest to them (2003).
Bruni, Beraldi, and Conforti use an undirected graph to model a complex water distribution network (2016).
% Make a comment on how Markov chains are useful for all of these subproblems
% Insert other examples here of P-median problems that Markov models can be used to solve

Paragraph (or two) about distance models, applications, successes, and disadvantages.

% Euclidean distance model

	% applications

    % successes

    % disadvantages

% Markov models(.5 of Lit Review)

Consider, for example, the $P$-median problem.
Using the optimization techniques developed by the literature, a decision maker can introduce a new facility that will give the most access, as measured by the inverse of distance, to the consumers that they want to reach. %Citation needed
Even with some additional conditions imposed on the problem, such as ******* and *******, there are still studied solutions to these questions.%Citation needed
Via modeling the same system as a network, a Markov chain can be used to optimize the ease of access to a facility under the feedback mechanism of busyness; the amount of throughput occurring in each facility; the access of only those consumers who have the least access initially, and so on. %claim of the paper, probably should be at end of lit review.

One of the significant tools in this process is the steady-state, or equilibrium state, of the Markov chain.
This can be calculated in a straightforward manner from the transition matrix used in the Markov chain.
This steady-state is a vector consisting of what is qualitatively understood as the long-term proportion of consumers that remain in a certain state. %Cite some PageRank stuff and the bus paper
Because the transition matrix can be easily updated, we can easily measure the long-term effects of placing a new facility in a particular location.
	% Mostly the bus paper unless we find more

\section{Markov Chain Modeling}

Using properties of a Markov chain, one can make decisions about the ``best'' place to place a facility under different definitions of ``best''.
Where the $P$-median problem optimizes solely on distance, a Markov chain can be used to optimize on many different attributes of the network.
In this section, we develop this idea through a brief mathematical review of Markov chains.
Then, we demonstrate the construction and analysis of such on real-world networks. %Really?
Finally, we discuss the qualitative and quantitative results of the models that were created, in which the strengths and weaknesses of each objective function is discussed. %The ordering of these might be a little off.

\subsubsection{Background}

A Markov chain is an example of a stochastic simulation of a $n$ state closed system in discrete time.
We create an $n\times n$ matrix $P$ where $P_{i,j}$ represents the probability of moving from state $i$ to state $j$ in one time step.
We observe that in each time step, the probability that a person moves from state $i$ to another state in the system is 1 because we have a closed system.
This means that each row in our transition matrix should have sum equal to one, which is known as {\em row stochastic}.
We note that an equivalent construction can be used where the columns sum to one, but we choose the convention of row stochastic.%Check if operations research does rows or columns

One of the powerful applications of Markov chains is that we can simulate a steady state solution very easily.
We can model any initial condition (or distribution of people) as a vector $x_0$ and see what happens after one time step by letting $x_1 = P x_0$.
More generally, we say $x_{n + 1} = P x_n$.
Because we have a row stochastic matrix, we can see that the all-ones vector is an eigenvector of $P$, which implies that its spectral radius is 1. %citation
The Perron Frobenious Theorem tells us that in this case, the dominant left eigenvalue is 1, and that it has an all-positive eigenvector.%cite
This eigenvector is known as the Perron eigenvector and is important for our analysis of the model because it represents the steady state of the model. %citation
We use this steady state solution to observe what happens to the distribution of people when a new facility is added in any given location.

For a more in-depth background to Markov chain modeling please refer to the paper by Faizrahnemoon, Schlote, Maggi, Crisostomi, and Shorten (2015).

%Justification for use in location theory?  The outline has it here, but we may cover it well enough elsewhere

\subsubsection{Model Setup}

The Markov chain that we use is based on the Markov chain application of Faizrahnemoon, Schlote, Maggi, Crisostomi, and Shorten (2015).
It involves two stages: the initialization of the model transition matrix and the computation of the Perron eigenvectors and the Mean First Passage Time described above.
\begin{figure}
\[
\renewcommand{\arraystretch}{1.5} % give some more room
\left[\begin{array}{@{}c|c@{}}
  SS &
  ST
\\ \hline
  TS
  & TT
\end{array}\right]
\]
\caption{Block diagram of transition matrix}
\end{figure}

\begin{table}
\begin{tabular}{c | p{5cm}}
Variable & Description\\
\hline
$n$ & Number of states\\
$k$ & Number of states corresponding to consumers\\
$X$ & Transition matrix of the Markov Chain\\
$r$, $s$, $v$ & Parameters for weighted distance function\\
$p$ & Probability a consumer visits the supplier in one time step\\
$d_{i}$ & Distance from consumer $i$ to the nearest supplier\\
\end{tabular}
\caption{Generic variables used in the setup of the Markov chain.}
\end{table}

Delineation of generic variables:


$d_{i}$ - distance from consumer $i$ to the nearest supplier

To begin, we initialize the transition matrix $X$ to be an empty $n \times n$ matrix.
Each row and column $0 \leq i \leq k$ represents a consumer $x_i$ and each row and column $k < j \leq n$ represents a supplier $y_j$.
This notation will continue to distinguish consumers and suppliers, though they are entries in one transition matrix. %will get confusing, probably

All distance values in the formulation of the model will be weighted by a logistic equation $g(d): \mathbb{R} \rightarrow [0,1]$ of the form:
$$g(d) = \frac{1}{1 + e^{r(d-s)}} - v$$
Where $r$,$s$, and $v$ are parameters which model  a weighted distance between $0$ and $1$ to represent the motivations of the consumer when they are distance $x$ from a supplier. %can we get better intuition of what r, s, v represent?  What kind of motivations?

The values on the diagonal where $0 \leq i \leq k$ are computed to represent the probability of staying at consumer location for one time step.
These are calculated as follows:

$$x_{ii} = (1-p) + p(g(d_{i}))$$

Any proprtion of the population moving from a consumer state to another consumer state is ignored. %movement is the wrong word?
So, for $0 \leq i,m \leq k$, $x_{im} = 0$ and $x_{mi} = 0$ if $i \neq m$.

Then to consider movement from a consumer to a supplier, we have $d(x_i, y_j)$ as the Euclidean distance from $x_i$ to $y_j$ and:
$$D_i = \sum_{j=k}^{n} \frac{1}{e^{d(x_i,y_j)}}$$

Then,
$$x_{ij} = x_{ii} \times \frac{\frac{1}{e^{d(x_i,y_j)}}}{D_i}$$
%(IS THIS CORRECT? - Doesn't include weights yet.)

The movement from suppliers to themselves are then set to 0.
So,

$$y_{jj} = 0$$

And for $k < l \leq n$,

$$y_{jl} = 0$$ %could be done by block TT = 0

The next consideration is movement from suppliers to consumers, which is as follows:

$$y_{ji} = \frac{(1-x_{ii})\times x_{ji}}{E_j}$$

where, 

$$E_j = \sum_{m=0}^{k} (1-x_{mm})\times x_{kj}$$

Note that this construction results in $X$ being a row stochastic matrix.
However, there are possible visits of any consumer to any supplier at random.
Thus, a ``teleport'' factor was included to make the matrix ergodic and to account for random perturbations in the network.

This was calculated as follows:
With $e$, a small number greater than zero, as a teleport factor, all elements of $X$ are multiplied by $(1-e)$ and 
$$x_{cd} = x_{cd} + \frac{e}{n}$$
This results in a matrix that is both row stochastic and ergodic.


% analysis

	% what we learned about Markov models

    % results from general testing of our model

    	% situations with ground truth

        % sensitivity

    % proposed solution

\subsection{Proposed Metrics}
The following metrics are ways to measure the effectiveness of a network.
Each metric measures the network slightly differently and each can be used to optimize the network.
We will explain each in detail and discuss what each metric measures.
We will also give justification in the form of empirical test cases.
We will refer to the transition matrix in blocks, as outlined in figure (>?).


Figure: The test cases - ellipse, hyperbola, circles, with the results from each metric plotted on top.


\subsubsection{Mean First Passage Time}
The mean first passage time is given by
$$ M = [I - X^{\#} + J_{n}X_{d}^{\#}]\Pi^{-1} $$
Where $I$ is the $n \times n$ identity matrix, $X^{\#}$ is the {\em group inverse} of the transition matrix $X$, $J_{n}$ is the $n \times n$ matrix of all ones, $X_{d}^{\#}$ is the $n \times n$ diagonal matrix whose diagonal entries are the corresponding diagonal entries of $X_{\#}$, and where $\Pi$ is the diagonal matrix whose diagonal entries are the corresponding entries of the equilibrium state vector of the transition matrix (Kirkland, Neumann, Sze, 2008) %This is copied pretty much word for word from the source, but I don't know of a better way to do it... Is that OK?
It is a matrix the same size as the transition matrix and the ijth entry gives the average number of timesteps required for a person starting in state i to move to state j.
The block format of the transition matrix continues into the matrix of the mean first passage times.
We are not concerned with the values in the SS, TS, or TT block because it is the ST block that represents the amount of time it takes for consumers to get to a producer.
However, under a different problem formulation, these blocks could give meaningful information.
In fact, we're not even interested in all of the values in the ST section, only those that are relatively small.
In a large network, a person in Alabama is not likely to drive to Montana to do their shopping, so while there is a mean first passage time from Alabama to Montana, it is very large, and this time should have little effect on our decision.
The harmonic mean is a way to discount the large outlying values while putting emphasis on the smaller values.
So we take the harmonic mean (DEFINE) of all of the values in the ST section of our matrix, and optimize on that.
We want to make the harmonic mean of the row of the ST block as small as possible, as this represents a small average travel time to the producer, and having consumers closer to producers is valuable to a producer.
By optimizing on the mean first passage time, we are reducing the overall difficulty of getting to a producer, which is desirable behavior in the network.

\subsubsection{Throughput}
In order to increase revenues, a reasonable thing to optimize is the number of people who go through a producer.
For example, a restaurant wants the most people to go through each location.
The first Perron eigenvector is the steady state of the network. %stronger beginning required
Each entry in the eigenvector gives the percentage of people in that state in the long term or equilibrium. %weak
By this construction, the last n places in the steady state vector correspond to the number of people who are at a location of commerce in a given day.
To maximize the number of people who visit the supplier, it is desirable to increase the sum of the last n states in the steady state vector.
This will maximize the throughput of the locations overall.
If there are more people at the store daily, then revenues will increase, so this is a desirable behavior in the network.
In order to optimize on the last section of the first Perron eigenvector, we take the proposed location for the new facility, calculate the transition matrix for the network with the proposed facility, and compute the first Perron eigenvector.
Then, we sum the last n entries in the vector.
Maximizing this sum will allow us to find the location where we have the most people passing through each facility.
In comparison to the mean first passage time, the optimization problem induced by this metric is throughput-centric.

\subsubsection{Top-tier}
It also may be of interest to enlarge a consumer by focusing on increasing accessibility for those who are currently have the most difficulty getting to suppliers.
The consumer entries with the highest values in the equilibrium vector will have the highest percentage of people are in that location at any given day.
In order to get their business, we want them to leave their original location, which would correspond to a reduction in their entry in the Perron eigenvector.
To do this, we compute the Perron eigenvector for the network before adding a new facility and note the states that have the highest values in the eigenvector.
We choose the top X% to minimize.
The best location under this metric will then be the location that minimizes these locations in the Perron eigenvector.
By optimizing on this metric, we ensure that the people that have the most difficulty getting to a producer will be able to get to a producer.
This is important for situations like hospitals or fire stations where the furthest people are the most important to consider.

\subsubsection{Kemeny Constant}
The Kemeny constant is defined to be (DEFINITION).
It appears to measure the connectedness of the network.
By optimizing on the Kemeny constant, the graph becomes more connected; that is, it is easier to reach any state from any other state.
This would be useful in situations like warehouses and distribution centers, where it is important for there to be many links from warehouses to distribution centers to minimize distance driven by a trucker or the distance produce needs to travel.

\subsubsection{Second Perron Eigenvector}
While we did not do much analysis of the second Perron eigenvector, (CITATION) says that it describes the clustering of the graph.
This can inform about the which producer and consumer clusters have the lowest ratio of producer to consumer, and placing a facility in such a cluster would theoretically have beneficial effects.
The new facility could also be placed to attempt to merge clusters, allowing for greater connectivity in the network.

\section{Case Study}

In this section we present an example of a facility location problem, in which some, but not all, of the metrics discussed previously give valuable information. 
The example given here is that of The Church of Jesus Christ of Latter-Day Saints (the LDS church) building new temples.


For members of the LDS Church, temples are a facility of worship and are believed to be imperative in the process of gaining salvation.
In this problem, we assume that the LDS Church is attempting to satisfy one of two goals, either increasing the access that its members have to temples or generating the highest attendance to its temples overall.

As a control case, we use a $P$-median method to minimize the distance of each church member to their closest temple.
The distance is measured as a transformation of the geophysical distance, which is in turn calculated via Vincenty's Formulae. %Citation Needed
We will refer to the Vincenty distance by $d_{v}$. %explanation of vincenty's formula?
The transformation is given by:
\begin{equation}
f(d_{v}) = \frac{1}{1+e^{-0.053*(d_{v} - 70)}} - 0.024.
\end{equation}

This is a special case of g(d) with the constants $r$, $s$, and $v$ chosen to mimic the effect of a temple a certain distance away.
Here, the assumption is that the difference between having a temple 5 miles away and 10 miles away is marginal, as is the difference between having a temple 200 miles away and 400 miles away.
The assumption implies that the biggest impact will come from people who were previously about 90 miles away from a temple and are now 20 miles away.

In the LDS church, members are grouped by geographical area.
Each cluster of members is called a stake, and a building of worship, called a stake center, is located within each stake.
For our model, instead of the residence of each individual member, we use the location of the stake center to calculate $d_{v}$.
%Note that, instead of using the residence of each individual member, $d_{v}$ is calculated using the location of a stake center.
Let each stake center be represented as $s_i$, each temple as $t_j$, the set of all the stake centers as $S$, the set of original temples as $T$, and the set of new temples as $T_{\text{new}}$. %Delineate with the other case study-related variables.
An example representation of the setup of this problem with each stake being connected to its two closest temples can be found in Figure 1.
The average distance a given member of a LDS stake has to travel to get to their closest temple is

\begin{equation}
	f(S,T) = \sum_i \underset{j}{\text{min}}\{d(s_i,t_j)\}.
\end{equation}
Thus, the unconstrained optimization problem can be written as

\begin{equation}
\begin{aligned}
	\minimize_{T^*} f(S,T^*), \text{ where } T^* = T \cup T_{\text{new}}.
\end{aligned}
\end{equation}

\begin{figure}[h!]
\centering
\begin{tikzpicture} [->, >=stealth' ,shorten >=1pt, auto,node distance=2.25cm,thick,main node/.style={circle,draw,font=\sffamily\Large\bfseries}]
\node[main node] (1) {$T_{1}$}; % Creates a node referred to as (1) with label T_1
\node[main node] (2) [below left of=1] {$S_{1}$}; % Creates the node and positions it
\node[main node] (3) [above right of=1] {$S_{5}$};
\node[main node] (4) [right of=1] {$S_{4}$};
\node[main node] (5) [below right of=1] {$S_{3}$};
\node[main node] (6) [right of=4] {$T_{2}$};
\node[main node] (7) [above of=6] {$S_{6}$};
\node[main node] (8) [below right of=5] {$T_{3}$};
\node[main node] (9) [below of=1] {$S_{2}$};
\node[main node] (10) [below of=6] {$S_{7}$};
\path[every node/.style={font=\sffamily\small}]
(2) edge node [right] {0.6} (1) % Adds an edge from node (2) to node (1) with the label of 0.6 on the right of the edge
(2) edge [bend right] node [left] {1.5} (8) % Adds a curved edge from node (2) to node (1) with the label of 1.5 on the left of the edge
(3) edge node[left] {0.4} (1)
(3) edge [bend left] node [right] {1.2} (6)
(4) edge node [above] {0.2} (1)
(4) edge node [above] {0.4} (6)
(5) edge node [right] {0.3} (1)
(5) edge node [right] {0.3} (8)
(7) edge node [right] {1.6} (1)
(7) edge node [right] {0.7} (6)
(9) edge node[right] {0.4} (1)
(9) edge node [above] {1.2} (8)
(10) edge node [right] {0.8} (6)
(10) edge node [above] {0.2} (8);
\end{tikzpicture}
\caption{A sample graph including $7$ stakes and $3$ temples. \textbf{Note}: Edges in this figure are a measure of distance, not a measure of probability.} % Maybe edges should correspond to probability?
\label{fig:M1}
\end{figure}

To determine the cardinality of $T_{\text{new}}$ to use in our experiments, we performed hill climbing to see if building multiple temples at once would change where the new temple locations would be. %explanation
We found that the US is spread out enough that determining the location of multiple temples at once is not significantly different than determining the temples' locations one at a time.
Thus, for ease of computation, we only considered $T_{\text{new}}$ with carnality 1;
That is, we assume only one temple is to be added at a time.

To minimize the objective function, we used a pseudo Monte Carlo method in which we divided the United States into one million evenly spaced points and evaluated the objective function at each point.
For the test case, we used the WDM as a comparison of what the $P$-median problem would yield.
The proposed metrics used were mean first passage time and throughput because they correlate with the two factors that we considered to be most important in this case.
\subsection{Weighted Distance Model Setup}

To fully understand the model, it is crucial to know what factors were considered relevant.
Chief among these factors is the distance $d(s_i,t_j)$ from a stake center to a temple. %standardize distance notation
% Do we need to add a reference for the Vincenty algorithm below?
This distance is measured using the Vincenty Algorithm in order to account for the shape of the earth and give accurate measurements based on latitude and longitude. %mentioned earlier, could be expanded upon there and deleted here (l. 319)
We admit that this is a naive Euclidean distance not based upon actual driving distances.
We found that using a Google API to find all of these actual distances was time-consuming, but could be considered for increased accuracy in future work. %awkward
This factor was used in both our Weighted Distance and Markov models.

The only other relevant factor to the WDM was the weight associated with each distance, $\omega_i$. %put in delineation of variables.
For convenience, we set these weights to $1$ to get our initial result.
%In further implementations, individual weights can be manually adjusted to account for other factors (traffic, tolls, etc.).
As this is a standard $P$-median problem, the weights can be adjusted to account for additional factors, as desired.

The WDM is designed to minimize the average weighted distance a given member of a LDS stake has to travel to get to their closest temple.
As such, this model does not take into account the capacity of the temples, nor the relative accessibility of other temples, even if they are a similar distance away.
The only assumption made about the behavior of church members is that they desire to have a temple close to their stake center, and that they will only use the closest temple to them. %did we do the 5 closest temples here? Or do we need new data with the 1 closest?

\subsection{Markov Model Setup}

To solve this problem, we used the Markov chain model that can be found in Section 3 using the variables in Table 1.
To simplify this model and to make an analytical review of temple location optimization possible, a number of assumptions were made.
First, we assumed that every LDS stake in the United States has the same number of active, temple-going members contained within its boundaries.
This approximation, combined with the assumption that every stake center is located at the center of the stake, allowed us to estimate the member density of each stake, $\rho_i$.
The purpose of $\rho_{i}$ is to relate how much traffic each stake would provide to its nearest five temples. %should probably use just nearest 1, it makes more sense.

\begin{table}
\begin{tabular}{c | l}
Variable & Description\\
\hline
$d(s_i,t_j)$ & Distance from stake $s_i$ to temple $t_j$\\
$\rho_i$ & Density of stake $s_i$\\
$S$ & Set of all stakes\\
$s_i$ & Stake number $i$\\
$T$ & Set of all temples\\
$T_{\text{new}}$ & The proposed new temple locations\\
$t_i$ & Temple number $i$ \\
$\tau_i$ & Temple score of temple $t_i$\\
\end{tabular}
\caption{Important variables for the Markov model used to solve the LDS location problem.}
\end{table}

Next, for each stake, we assumed the number of members that attend the temple on an average day given the stake center's Euclidean distance (again determined by the Vincenty Algorithm) to and the busyness of its 5 closest temples.
% Insert mathematical formula or explanation of the code here.
We determined the busyness of a temple, $\tau_i$, based on the number of stakes that listed that temple as one of its five closest temples. %Didn't use busyness in most recent iteration of model
% Insert mathematical formula here.

In order to create this model, we initialize a square probability matrix $P$ in which the first $k$ rows and columns correspond to the stakes in the United States and the next $m$ rows and columns correspond to the temples in the United States.
Each $P_{ij}$ in the matrix represents the probability that a person in row $i$ will travel to column $j$ in the current state.
The diagonal entries $P_{ii}$ represent the probability that a person will remain in their current state.
The time, in this case, is in days, so each multiplication of the transition matrix onto a distribution vector will simulate one day passing.

% Create a visual matrix representation of the matrix initialized | There's a version where the magnitude of the entry is color in No_Busyness_Test.ipynb

We begin populating the matrix by allowing the diagonals $P_{ii} = p + f(d)$ with $p$ = $29/30$ which numerically represents the assumption that in each state, $1/30$ of a stake's temple attendees will attend the temple in a given day (using f from $(1)$).
We follow the procedures outlined in section 3.2 to populate the remainder of the matrix.
%We then adjust this number according to $g(d)$ described in 
%To do so, we compute a measure of busyness by taking into account the number of stakes within a close proximity to each temple.
%The required numerical representations are described below.

%\begin{equation}
%\begin{aligned}
%Ts_j = \sqrt{1\over{\sum_j{t_{ij}}}}
%\end{aligned}
%\end{equation}

\subsection{Results}

This will be filled in soon, once we've run the final model on the case study data.
We will present the results of the case study, compare them to the results from the $P$-median problem, and discuss the advantages and disadvantages of using the Markvo chain.
	% state the results of the case study

    % compare to Euclidean model

    	% advantages

        	% Easier customization and fine tune the results

            % clustering

        % disadvantages

        	% much more complex to implement

    % sensitivity testing

    	% not a smooth function (ellipses) - changing where new temples are located

\section{Conclusion}

Discrete mathematics is already in wide use in facility location theory. %citation needed
The development and discussion of methods based on the Markov chain is another example of using tool from discrete mathematics to give researchers and decision makers more information.
A system modeled as a network via a Markov chain can be analyzed to optimize its throughput, connectedness, and many other mathematical properties, each with possible applications in the area of facility location theory.
According to the arguments given here and the computational evidence, there is strong reason to believe that the simplified qualitative interpretation of the metrics used to optimize a network indeed work as presented.

In the conclusion, we will also cover ideas for application and further work.

% What has been accomplished/shown in this paper

	% Ideas for further work
	% Clustering

  % Ideas for possible applications

  	% Utilities

    % Stores/consumers

    % supply chain management

\begin{thebibliography}{99}

\bibitem[Berman, Drezner, Wesolowsky, 2003]{Berman:2003}
Berman O, Drezner Z, Wesolowsky G.
\newblock Locating service facilities whose reliability is distance dependent.
\newblock {\em Computers \& Operations Research.} 2003; 30:1683-1695.

\bibitem[Bose, Maheshwari, Morin, 2003]{Bose:2003}
Bose P, Maheshwari A, Morin P.
\newblock Fast approximations for sums of distances, clustering and the Fermat-Weber problem.
\newblock {\em Computational Geometry.} 2003; 24:135-146.

\bibitem[Bruni, Beraldi, Conforti, 2016]{Bruni:2016}
Bruni M, Beraldi P, Conforti D.
\newblock Water distribution networks design under uncertainty.
\newblock {\em TOP.} 2016; 25:111-126.

\bibitem[Current, Min, Schilling, 1990]{Current:1990}
Current J, Min H, Schilling D.
\newblock Multiobjective analysis of facility location decisions.
\newblock {\em European Journal of Operational Research.} 1990; 49:295-307

\bibitem[Faizrahnemoon, Schlote, Maggi, Crisostomi, Shorten, 2015]{Faizrahnemoon:2015}
Faizrahnemoon M, Schlote A, Maggi L, Crisostomi E, Shorten R.
\newblock A big-data model for multi-modal public transportation with application to macroscopic control and optimisation.
\newblock {\em International Journal of Control.} 2015; 88:2354-2368.

\bibitem[Ghosh, Gosavi, 2017]{Ghosh:2017}
Ghosh S, Gosavi A.
\newblock A semi-Markov model for post-earthquake emergency response in a smart city.
\newblock {\em Control Theory and Technology.} 2017; 15: 13-25.

\bibitem[Jakubovskis, 2017]{Jakubovskis:2017}
Jakubovskis A.
\newblock Strategic facility location, capacity aquisition, and technology choice decisions under demand uncertainty: Robust vs. non-robust optimizations approaches.
\newblock {\em European Journal of Operational Research.} 2017; 260:1095-1104.

\bibitem[Kirkland, 2014]{Kirkland:2014}
Kirkland S.
\newblock Load balancing for Markov chains with a specified directed graph.
\newblock {\em Linear and Multilinear Algebra.} 2014; 62: 1491-1508.

\bibitem[Kirkland, Neumann, Sze, 2014]{Kirkland:2008}
Kirkland, S.J., Neumann, M. \& Sze, NS.
\newblock On Optimal Condition Numbers for Markov Chains
\newblock {\em Numer. Math.} 2008 110:521
%https://doi.org/10.1007/s00211-008-0172-8

\bibitem[Klose, Drexl, 2005]{Klose:2005}
Klose A, Drexl A.
\newblock Facility location models for distribution system design.
\newblock {\em European Journal of Operational Research} 2005; 162:4-29.

\bibitem[Krogh, Brown, Mian, Sjolander, Haussler, 1994]{Krogh:1994}
Krogh A, Brown M, Mian I S, Sjolander K, Haussler D.
\newblock Hidden Markov models in computational biology: applications to protein modeling.
\newblock {\em Journal of Molecular Biology.} 1994; 235:1501-1531.

\bibitem[Melo, Nickel, Saldanha-da-Gama, 2009]{Melo:2009}
Melo M, Nickel S, Saldanha-da-Gama F.
\newblock Facility location and supply-chain management - A review.
\newblock {\em European Journal of Operational Research.}  2009; 196:401-412.

\bibitem[Monson, 1995]{Monson:1995}
Monson T.
\newblock Blessings of the Temple. 1995;
\newblock Retrieved from https://www.lds.org/church/temples/why-we-build-temples/blessings-of-the-temple?lang=eng

\bibitem[Ndiaye, Ndiaye, Ly, 2012]{Ndiaye:2012}
Ndiaye F, Ndiaye B M, Ly I.
\newblock Application of the p-Median problem in School Allocation.
\newblock {\em American Journal of Operations Research.} 2012; 2:253-259.

\bibitem[Newman, 2003]{Newman:2003}
Newman M E J.
\newblock The structure and function of complex networks.
\newblock {\em SIAM REVIEW.} 2003; 45:167-256.

\bibitem[Owen, Daskin, 1998]{Owen:1998}
Owen S, Daskin M.
\newblock Strategic facility location: a review.
\newblock {\em European Journal of Operational Research.} 1998; 111:423-447.

\end{thebibliography}

\end{document}


%Could we use markov chains in advertisement analysis?  The assumption would be that the limiting factor for someone to purchase something is that they don't know, and we could change values in the transition matrix to model that?