\documentclass[twoside,twocolumn]{article}
\usepackage{blindtext}
\usepackage{amsmath}
\DeclareMathOperator*{\minimize}{minimize}
%\usepackage[T1]{fontenc}
\usepackage{microtype}
\usepackage[english]{babel}
\usepackage[hmarginratio=1:1,top=32mm,columnsep=20pt]{geometry}
\usepackage[hang, small,labelfont=bf,up,textfont=it,up]{caption}
\usepackage{booktabs}
\usepackage{lettrine}
\usepackage{enumitem}
\setlist[itemize]{noitemsep}
\usepackage{abstract}
\renewcommand{\abstractnamefont}{\normalfont\bfseries}
\renewcommand{\abstracttextfont}{\normalfont\small\itshape}
\usepackage{titlesec}
\renewcommand\thesection{\Roman{section}}
\renewcommand\thesubsection{\roman{subsection}}
\titleformat{\section}[block]{\large\scshape\centering}{\thesection.}{1em}{}
\titleformat{\subsection}[block]{\large}{\thesubsection.}{1em}{}
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhead{}
\fancyfoot{}
\fancyhead[C]{ FACILITY LOCATION USING MARKOV CHAINS $\bullet$ OCT 2017}
\fancyfoot[RO,LE]{\thepage}
\usepackage{titling}
\usepackage{hyperref}
\usepackage{tikz}
\usetikzlibrary{arrows}
\usepackage{graphicx}
\usepackage{amssymb}

\setlength{\droptitle}{-4\baselineskip}
\pretitle{\begin{center}\Huge\bfseries}
\posttitle{\end{center}}
\title{Facility Location Using Markov Chains}
\author{
\textsc{Applied Mathematical Modeling Research Team}\\[1ex]
\normalsize Brigham Young University \\
\normalsize \href{mailto:amm@math.byu.edu}{amm@math.byu.edu}
}
\date{\today}
\renewcommand{\maketitlehookd}{
\begin{abstract}
\noindent We consider using Markov chains to solve facility location problems.
In particular, we find a Markov chain when coupled with realistic assumptions about a consumer-supplier network is able to answer questions such as: Where should a facility be placed to have the most consumer throughput, or so that the most neglected customers can have increased ability to access it?
We present an example construction including computational results for finding the best location in the United States for a new temple to be built by a national church.
\end{abstract}
}

% General Suggestions from Dr. Jarvis from several months ago:
%   - Use active voice wherever possible.
%   - Standardize citation method, put years next to the authors' names.
%   - Advertise for our methods --> hearken back to the new things that we're doing as often as possible.
%   - Standardize the language. (supplier/consumer or something)
%   - Remember that our audience wants to solve a problem, not do math.

% Big Ticket Items:
% There are several figures to be included
% The Literature Review section needs to finished/expanded, as well as double checked in its claims
% Some of the formulae in here are out of date
% The conclusion need to be expanded slightly
% Feel free to add more references in the text and bibliography, we are currently underreferencing

\begin{document}
\maketitle

\section{Introduction}

Problems in facility location theory focus on finding optimal locations for facilities to meet consumer demand, either in adding new facilities or relocating existing ones.
There are a myriad of ways to define an optimal location, but the standard definition is a location that minimizes the average distance traveled by a consumer to fulfill a demand (Owen \& Daskin, 1998).
Additional definitions of optimal include the location that minimizes the maximum distance traveled to fulfill a demand, the location to maximize the throughput of the suppliers, or the location that minimizes the average time consumers have to travel to suppliers.
In this paper, we show that a Markov chain can be used to solve facility location problems based on some of these definitions of optimal, as well as others we introduce in the section on proposed metrics.

A fundamental facility location problem is the $P$-median problem, which tries to minimize the distance that a consumer must travel to reach their nearest facility (Current, Min, \& Schilling, 1990).
Typical applications of $P$-median problems include finding optimal locations for industrial warehouses to minimize shipping distances (Jakubovskis, 2017), stores to maximize availability to customers (Klose, Drexl, 2005), and emergency response public services where response time is imperative (Ghosh, Gosavi, 2017).
As a special case of the $P$-median problem, we will be contrasting our analysis with the Fermat-Weber problem (Bose, Maheshwari, Morin, 2003). 
We call our approximate solution to the Fermat-Weber problem the Weighted-Distance Method (WDM). %Pick a name and call it that. Just make sure to check the rest of the paper.
This method considers the Euclidean distance between the consumers and the potential facility. 
An example of this model in application can be found in the paper by Ndiaye, Ndiaye and Ly (2012).

In comparison to the WDM, the main approach employed in this paper is to use a Markov chain to model the behavior of consumers as they interact with facilities. 
An interaction could be a sale made, a visit to a retail location, or any other meaningful experience that a consumer would have with a supplier.
Markov chains reveal the effects that simple local behaviors have on more complex global behaviors through modeling the behavior as a network.
This is similar to the goal of many facility location problems, as it is often the case that the behavior being optimized is about the aggregate populous and not the specific actions of certain individuals.
Markov chains have been used in many applications, including: mathematical ecology (Kirkland, 2014), computational biology (Krogh, Brown, Mian, Sjolander, Haussler, 1994), and network modeling (Newman, 2003), but they have not been commonly used in facility location problems.
In this paper, we show that Markov chains provide a flexible and efficient way to model facility location problems.
Also, they offer additional information not found in the standard analysis of the $P$-median problem.

This paper proceeds as follows.
Section 2 contains a literary review of facility location problems on which Markov chains could potentially be used, as well as literature pertaining to the WDM and the Markov chain method. 
Section 3 will outline the construction of the Markov transition matrix used to solve facility location problems, give the results of the general testing of the model and expand on insights gained while studying the model.
Section 4 expounds on the set up and results of using our model to determine new locations for temples of The Church of Jesus Christ of Latter-Day Saints (LDS church).
Section 5 will conclude the paper with suggestions for further work.

\section{Literature Review}

Facility location management is a well-established area within operations research. %obvious
Current, Min and Schilling report that facility location management has been researched through the perspective of many different academic disciplines and cite a recent bibliography on this subject that had over 1500 titles, showing the vast expanse of research in this area (1990). %it's great they cite it, should we cite it directly?
Owen and Daskin, in their literature review, give an overview of the most-used models among this immense amount of literature.
They comment on 15 differing subsets of facility location problems, again demonstrating the vastness of the literature and applicability of the problem (1998).
Although the library of facility location management is large, this review focuses primarily on literature pertaining to median problems, with a specific emphasis on the use of Markov chain models. %model?  This seems like we want to talk about the use of markov chains in facility location management, which they aren't really.

The study of location theory began in 1909 when Alfred Weber was researching possible warehouse location based on the average distance to be traveled by those who would visit the warehouse (Owen \& Daskin, 1998).
His research created the basis for {\em median problems}, or problems that determine a facility location by minimizing the average distance traveled by consumers.
This distance is often weighted using factors like speed limits, traffic, proximity to competitors, and tolls. %citation needed
As noted by Melo, Nickel and Saldanha-da-Gamma, the $P$-median problem is considered to be the foundational median problem.
They define the $P$-median problem as the problem of placing $P$ facilities in locations that minimize the total weighted distance (or costs) to satisfy customer demands (2009).

From this rudimentary definition of a $P$-median problem arises a multitude of slight variations that account for the context of the problem.
For example, Berman, Drezner, and Wesolowsky use a model formulation which allows demands to be serviced by facilities other than the one closest to them (2003).
Bruni, Beraldi, and Conforti use an undirected graph to model a complex water distribution network (2016).
% Make a comment on how Markov chains are useful for all of these subproblems
% Insert other examples here of P-median problems that Markov models can be used to solve

Paragraph (or two) about distance models, applications, successes, and disadvantages.

% Euclidean distance model

	% applications

    % successes

    % disadvantages

% Markov models(.5 of Lit Review)

Consider, for example, the $P$-median problem.
Using the optimization techniques developed by the literature, a decision maker can introduce a new facility that will give the most access, as measured by the inverse of distance, to the consumers that they want to reach. %Citation needed
Even with some additional conditions imposed on the problem, such as ******* and *******, there are still studied solutions to these questions.%Citation needed
Via modeling the same system as a network, a Markov chain can be used to optimize the ease of access to a facility under the feedback mechanism of busyness; the amount of throughput occurring in each facility; the access of only those consumers who have the least access initially, and so on. %claim of the paper, probably should be at end of lit review.

One of the significant tools in this process is the steady-state, or equilibrium state, of the Markov chain.
This can be calculated in a straightforward manner from the transition matrix used in the Markov chain.
This steady-state is a vector consisting of what is qualitatively understood as the long-term proportion of consumers that are in a certain state. %Cite some PageRank stuff and the bus paper
As the transition matrix can be easily updated, we can easily measure the long-term effects of placing a new facility in a particular location.
	% Mostly the bus paper unless we find more

\section{Markov Chain Modeling}

Using properties of a Markov chain, one can make decisions about the ``best'' place to have a facility under different definitions of ``best''.
Where the $P$-median problem seeks to optimize distance, a Markov chain can be used to optimize many different attributes of a supply network.
In this section, we develop this idea and demonstrate the construction and analysis of such on real-world networks.
Finally, we discuss the qualitative and quantitative results of the models that were created, in which the strengths and weaknesses of each objective function is discussed.

\subsubsection{Background}

A Markov chain is an example of a stochastic simulation of a closed system with $n$ states in discrete time.
We create an $n\times n$ matrix $X$ where $x_{i,j}$ represents the probability of moving from state $i$ to state $j$ in one time step.
As this is a closed system, in each time step the probability that a person moves from state $i$ to some state in the system (including possibly remaining at $i$) is 1. 
This means that each row in our transition matrix should have sum equal to one, which is known as {\em row stochastic}.
We note that an equivalent construction can be used where the columns sum to one, but we continue with row stochasticity here.%Check if operations research does rows or columns

One of the powerful applications of Markov chains is that we can derive a steady state, or equilibrium solution, very easily.
We can model any initial condition (i.e. distribution of people) as a vector $w_0$ and see what happens after one time step by letting $w_1 = w_0 X$.
More generally, we say $w_{n + 1} = w_n X$.
Because we have a row stochastic matrix, we can see that the all-ones vector is a right eigenvector of $X$.
In the subsection Model Setup, we add a ``teleport'' factor to $X$, which results in it being an all positive matrix.
The Perron-Frobenius Theorem tells us that, in this case, the dominant eigenvalue of $X$ is 1 and that it has an all-positive left eigenvector.
This eigenvector is known as the Perron eigenvector and represents the steady state of the model. %citation
We use this steady state solution to observe what happens to the distribution of consumers when a new facility is added in a given location.

For a more in-depth background to Markov chain modeling please refer to the paper by Faizrahnemoon et al. (2015).

%Justification for use in location theory?  The outline has it here, but we may cover it well enough elsewhere

\subsubsection{Model Setup}

The Markov chain method that we use is based on that of Faizrahnemoon et al. (2015).
It involves two stages: the initialization of the model transition matrix and the computation of the Perron eigenvectors along with other variables.
\begin{figure}
\[
\renewcommand{\arraystretch}{1.5}
\left[\begin{array}{@{}c|c@{}}
  CC &
  CS
\\ \hline
  SC
  & SS
\end{array}\right]
\]
\caption{Block diagram of transition matrix}
\end{figure}


To begin, we initialize the transition matrix $X$ to be an empty $n \times n$ matrix.
Each row and column $0 \leq i \leq k$ represents a consumer $i$ and each row and column $k < j \leq n$ represents a supplier $j$. %how about c and s?
We use this notation will continue to distinguish consumers and suppliers.
However, for individual entries in the matrix, we employ the standard notation, $x_{i,j}$ as discussed previously.

Let $d_{i}$ be distance from consumer $y_i$ to their nearest supplier.
These distances are transformed by a sigmoid function $g(d_i): \mathbb{R} \rightarrow [0,1]$ of the form:
\begin{equation}
g(d_i) = \frac{1}{1 + e^{\gamma(d_i-\alpha)}} - \beta.
\end{equation}
This transformation allows the modeler to define a region of significance.
As an example of the use of this function, if a potential customer of a retail chain lives several hundreds of miles aways from the nearest location, then cutting that distance by twenty percent will not be a significance change for that consumer.
The parameters $\gamma$, $\alpha$, and $\beta$ represent, respectively, a stretch factor, a domain shift, and a range shift.
These will vary with the desired region of significance.

It is assumed that no consumer relocates to a different area.
So, for $0 \leq i,m \leq k$, $x_{im} = 0$ and $x_{mi} = 0$ if $i \neq m$.

Let $p$ be the probability that a consumer in the immediate vicinity of a supplier visits that supplier on any given day.
The values on the diagonal of $X$ represent the probability of a consumer not visiting a supplier for one time step.
These are calculated as follows:

$$x_{ii} = (1-p) + p(g(d_{i}))$$

where $0 \leq i \leq k$.

Then to consider movement from a consumer to a supplier, we have $d(i, j)$ as the Euclidean distance from consumer $i$ to supplier $j$ and:
$$D_i = \sum_{j=k}^{n} \frac{1}{e^{d(x_i,y_j)}}$$

Then,
$$x_{ij} = x_{ii} \times \frac{\frac{1}{e^{d(x_i,y_j)}}}{D_i}$$
%Needs to be corrected, as do other formulae in this portion.

The movement from suppliers to other suppliers is then set to 0.
So,

$$y_{jj} = 0.$$

And, for $k < l \leq n$,

$$y_{jl} = 0.$$

Or, equivalently, the SS block is the appropriately-sized matrix of zeroes.

The next consideration is movement from suppliers to consumers, which is calculatedas follows:

$$y_{ji} = \frac{(1-x_{ii})\times x_{ji}}{E_j}$$

where, 

$$E_j = \sum_{m=0}^{k} (1-x_{mm})\times x_{kj}.$$

This construction results in $X$ being a row stochastic matrix.
To make $X$ a positive matrix, we add a ``teleport'' factor distributed across each entry of each row.

This is done as follows:
Let $e$, a small number greater than zero, all elements of $X$ are multiplied by $(1-e)$ and 
$$x_{cd} = x_{cd} + \frac{e}{n}$$
This results in a matrix that is both row stochastic and ergodic.%For our records, what is our def. of ergodic that is being employed here?


    
\begin{table}
\begin{tabular}{c | p{5cm}}
Variable & Description\\
\hline
$i$ & A given consumer\\
$j$ & A given supplier\\
$n$ & Number of states\\
$k$ & Number of states corresponding to consumers\\
$X$ & Transition matrix of the Markov Chain\\
$\gamma$, $\alpha$, $\beta$  & Parameters for weighted distance function\\
$p$ & Probability a consumer visits the supplier in one time step\\
$d_{i}$ & Distance from consumer $i$ to the nearest supplier\\
$e$ & Teleport factor
\end{tabular}
\caption{Generic variables and parameters used in the setup of the Markov chain method.}
\end{table}

% analysis

	% what we learned about Markov models

    % results from general testing of our model

    	% situations with ground truth

        % sensitivity

    % proposed solution

\subsection{Proposed Metrics}
The following metrics are ways to measure the effectiveness of a network.
Each metric measures the network differently and each can be optimized in the network.
We will explain each in detail including what each metric measures.
We will also give justification in the form of an empirical test case.
We will refer to the transition matrix in blocks, as outlined in figure 1.%watch figure numbers


Figure: The test cases - ellipse, hyperbola, circles, with the results from each metric plotted on top.


\subsubsection{Mean First Passage Time}
Instead of minimizing the median Euclidean distance or the transformed distance from equation (1), minimizing a function of the mean first passage time minimizes the average number of time steps required for a given consumer to visit a certain supplier as the system progresses. %Develop this idea more, specifically with an example.

Following the notation and exposition in Kirkland et al. (2008), the mean first passage time is given by
$$ M = [I - X^{\#} + J_{n}X_{d}^{\#}]\Pi^{-1}$$
Where $I$ is the $n \times n$ identity matrix, $X^{\#}$ is the {\em group inverse} of the transition matrix $X$, $J_{n}$ is the $n \times n$ matrix of all ones, $X_{d}^{\#}$ is the $n \times n$ diagonal matrix whose diagonal entries are the corresponding diagonal entries of $X_{\#}$, and where $\Pi$ is the diagonal matrix whose diagonal entries are the corresponding entries of the equilibrium state vector of the transition matrix.%This is copied pretty much word for word from the source, which is not ok.
The group inverse is the unique matrix that satisfies $X^{\#}XX^{\#} = X^{\#}$, $XX^{\#}X = X$, and $XX^{\#} = X^{\#}X$.
It is a matrix the same size as the transition matrix and the $ij$th entry gives the average number of timesteps required for a person starting in state $i$ to get to state $j$.
The block format and meaning of the transition matrix carries over into the matrix of the mean first passage times.

We are not concerned with the values in the CC, SC, or SS block because it is only the CS block that represents the amount of steps it takes for consumers to get to a supplier.
However, under a different problem formulation, these blocks could give meaningful information.
In fact, we are not even interested in all of the values in the CS section, only those that are relatively small.
In a large network, a person in Alabama is not likely to drive to Montana to do their shopping, so while there is a mean first passage time from a consumer in Alabama to a center in Montana, it is very large, and this time should have little effect on our decision because it is not correct behavior.
The harmonic mean is a way to discount the large outlying values while putting emphasis on the smaller values.
So we take the harmonic mean of all of the values in a given row in the CS section of our matrix, and optimize on that.
Given values $m_{1}, \hdots, m_{n}$, the harmonic mean is 
$$\frac{1}{\frac{1}{m_{1}} + \hdots + \frac{1}{m_{n}}}$$
We want to make the harmonic mean of the row of the CS block as small as possible, as this represents a small average travel time for a consumer to arrive at a supplier, and having consumers closer to suppliers is valuable to a supplier.
By optimizing on the mean first passage time, we are reducing the overall difficulty of getting to a supplier, which can be a desirable behavior in the network.

%Is the harmonic mean enough?  We should check what kind of values that kicks out and see how much it's being swayed by the big numbers.
%We have an alternate hypothesis about just taking the minimum MFPT entry for each row. This could be good, but we should discuss it more first.

\subsubsection{Throughput}
In order to increase revenues, a reasonable thing to maximize is the number of people that visit suppliers as time goes on.
For example, a restaurant wants the most people to go through each location.
If there are more people at the store daily, then revenues will increase, which can be a desirable behavior in the network.

Referencing the first Perron eigenvector again, we can see the steady state of the network. 
Each entry in the eigenvector gives the proportion of people in the in that state in the long term or equilibrium. 
By this construction, the last $n$ places in the eigenvector correspond to the number of people who visit a supplier in a given day.
To maximize the number of people who visit the supplier, we maximize the sum of these last n places in the eigenvector.
To carry this out, we take the proposed location for the new facility, calculate the transition matrix for the network with the proposed facility, and compute the first Perron eigenvector.
Then, we sum over the last $n$ entries in the vector.
In comparison to the mean first passage time, the optimization problem induced by this metric is throughput-centric.

\subsubsection{Top-tier}
It also may be of interest to enlarge a consumer base by focusing on increasing accessibility for those who are currently having the most difficulty getting to suppliers.
This would represent situations such as hospitals or fire stations that desire to minimize the difficulty for outliers to get to a supplier's location.
By doing this, the worst-case response time of the fire station will be decreased because the ability of outlier consumers to visit suppliers is increased.

In order to have the most benefit for the consumers that have the most difficulty getting to the suppliers, we again consider the first Perron eigenvector.
The consumer entries with the highest values in the equilibrium vector will have the highest proportion of people in that location at any given day.
In order to get their business, these consumers must be able to visit suppliers more easily, which corresponds to a reduction in their entry in the Perron eigenvector.
To do this, we compute the Perron eigenvector for the network before adding a new facility and note the states that have the highest values in the eigenvector.
We choose the top $L$\% to minimize, where $L$ varies based on the context of the problem being considered.
If $L$ is large, this metric turns into the throughput metric.
If $L$ is very small, then a few locations will dominate the decision-making process.
For example, if we choose only one location to reduce, then the logical thing to do would be to place a supplier right on that consumer's location.
By optimizing on this metric, we ensure that the people that have the most difficulty getting to a supplier will be benefited the most.

\subsubsection{Kemeny Constant}
The Kemeny constant is defined to be 
$$K = \sum_{\substack{\lambda \in \sigma(X) \\ \lambda \neq 1}} \frac{1}{1-\lambda}$$
Where $\sigma(X)$ is the spectrum of $X$ (get reference for cho and meyer 2001).
It measures the connectedness of a network.
By maximizing the Kemeny constant, the network becomes more connected; that is, it is easier to reach any state from any other state.
This would be useful in situations like warehouses and distribution centers, where it is important for there to be many links from warehouses to distribution centers to allow for flexible and optimized scheduling of transport of goods.

\section{Case Study}

In this section we present an example of a facility location problem, in which some, but not all, of the metrics discussed previously give valuable information. 
The example given here is that of The Church of Jesus Christ of Latter-Day Saints (the LDS church) building new temples.


For members of the LDS Church, temples are a facility of worship and visiting them is believed to be imperative in the process of gaining salvation.
In this problem, we assume that the LDS Church is attempting to satisfy one of two goals, either increasing the access that its members have to temples (Top-tier metric) or generating the highest attendance to its temples overall (Throughput metric).

As a control case, we use a $P$-median method to minimize the distance of each church member to their closest temple.
The distance is measured as a transformation of the geophysical distance, which is in turn calculated via Vincenty's Formulae. %Citation Needed
We will refer to the Vincenty distance by $d_{v}$. %explanation of vincenty's formula?
The transformation is given by:
\begin{equation}
f(d_{v}) = \frac{1}{1+e^{-0.053*(d_{v} - 70)}} - 0.024.
\end{equation}

This is a special case of \(1\) with the constants $\gamma$, $\alpha$, and $\beta$ chosen to mimic the effect of a temple a certain distance away.
Here, the assumption is that the difference between having a temple 5 miles away and 10 miles away is marginal, as is the difference between having a temple 200 miles away and 400 miles away.
The assumption implies that the biggest impact will come from people who were previously about 90 miles away from a temple and are now 20 miles away.

In the LDS church, church members are grouped by geographical area.
Each grouping of members is called a stake, and a building of worship, called a stake center, is located within each stake.
For our model, instead of the residence of each individual member, we use the location of the stake center to calculate $d_{v}$.
%Note that, instead of using the residence of each individual member, $d_{v}$ is calculated using the location of a stake center.
Let each stake center be represented as $s_i$, each temple as $t_j$, the set of all the stake centers as $S$, the set of original temples as $T$, and the set of new temples as $T_{\text{new}}$. %Delineate with the other case study-related variables.
An example representation of the setup of this problem with each stake being connected to its two closest temples can be found in Figure 1.
The average distance a given member of an LDS stake has to travel to get to their closest temple is

\begin{equation}
	h(S,T) = \frac{1}{n} \sum_i \underset{j}{\text{min}}\{d(s_i,t_j)\}.
\end{equation}
Thus, the unconstrained optimization problem can be written as

\begin{equation}
\begin{aligned}
	\minimize_{T^*} h(S,T^*), \text{ where } T^* = T \cup T_{\text{new}}.
\end{aligned}
\end{equation}

\begin{figure}[h!]
\centering
\begin{tikzpicture} [->, >=stealth' ,shorten >=1pt, auto,node distance=2.25cm,thick,main node/.style={circle,draw,font=\sffamily\Large\bfseries}]
\node[main node] (1) {$T_{1}$}; % Creates a node referred to as (1) with label T_1
\node[main node] (2) [below left of=1] {$S_{1}$}; % Creates the node and positions it
\node[main node] (3) [above right of=1] {$S_{5}$};
\node[main node] (4) [right of=1] {$S_{4}$};
\node[main node] (5) [below right of=1] {$S_{3}$};
\node[main node] (6) [right of=4] {$T_{2}$};
\node[main node] (7) [above of=6] {$S_{6}$};
\node[main node] (8) [below right of=5] {$T_{3}$};
\node[main node] (9) [below of=1] {$S_{2}$};
\node[main node] (10) [below of=6] {$S_{7}$};
\path[every node/.style={font=\sffamily\small}]
(2) edge node [right] {0.6} (1) % Adds an edge from node (2) to node (1) with the label of 0.6 on the right of the edge
(2) edge [bend right] node [left] {1.5} (8) % Adds a curved edge from node (2) to node (1) with the label of 1.5 on the left of the edge
(3) edge node[left] {0.4} (1)
(3) edge [bend left] node [right] {1.2} (6)
(4) edge node [above] {0.2} (1)
(4) edge node [above] {0.4} (6)
(5) edge node [right] {0.3} (1)
(5) edge node [right] {0.3} (8)
(7) edge node [right] {1.6} (1)
(7) edge node [right] {0.7} (6)
(9) edge node[right] {0.4} (1)
(9) edge node [above] {1.2} (8)
(10) edge node [right] {0.8} (6)
(10) edge node [above] {0.2} (8);
\end{tikzpicture}
\caption{A sample graph including $7$ stakes and $3$ temples. \textbf{Note}: Edges in this figure are a measure of distance, not a measure of probability. Not to scale.} % Maybe edges should correspond to probability?
\label{fig:M1}
\end{figure}

To determine the cardinality of $T_{\text{new}}$ to use in our experiments, we performed hill climbing to see if building multiple temples at once would change where the new temple locations would be. %explanation
We found that the US is spread out enough that determining the location of multiple temples at once is not significantly different than determining the temples' locations one at a time.
Thus, for ease of computation, we only considered $T_{\text{new}}$ with carnality 1;
That is, we assume only one temple is to be added at a time.

To minimize the objective function, we sampled the value of $h$ in the United States at one million evenly spaced points.
For the test case, we used the WDM as a comparison of what the $P$-median problem would yield.
\subsection{Weighted Distance Model Setup}

To fully understand the model, it is crucial to know what factors were considered relevant.
Chief among these factors is the distance $d(s_i,t_j)$ from a stake center to a temple. %standardize distance notation
% Do we need to add a reference for the Vincenty algorithm below?
This distance is measured using the Vincenty Algorithm in order to account for the shape of the earth and give accurate measurements based on latitude and longitude. %mentioned earlier, could be expanded upon there and deleted here (l. 319)
This is a naive Euclidean distance not based upon actual driving or walking distances.
Using an API to find all of these actual distances could be considered for increased accuracy in future work.

The only other relevant factor to the WDM was the weight associated with each distance, $\omega_i$. %put in delineation of variables.
For convenience, we set these weights to $1$ to get our initial result.
%In further implementations, individual weights can be manually adjusted to account for other factors (traffic, tolls, etc.).
As this is a standard $P$-median problem, the weights can be adjusted to account for additional factors, as desired.

The WDM is designed to minimize the average weighted distance a given member of a LDS stake has to travel to get to their closest temple.
As such, this model does not take into account the capacity of the temples, nor the relative accessibility of other temples, even if they are a similar distance away.
The only assumption made about the behavior of church members is that they desire to have a temple close to their stake center, and that they will only use the closest temple to them. %did we do the 5 closest temples here? Or do we need new data with the 1 closest?

\subsection{Markov Model Setup}

To solve this problem, we used the Markov chain model that can be found in Section 3 using the variables in Table 1.
To simplify this model a number of assumptions were made.
First, we assumed that every LDS stake in the United States has the same number of active, temple-going members contained within its boundaries.
This approximation, combined with the assumption that every stake center is located at the center of the stake, allowed us to estimate the member density of each stake, $\rho_i$.
The purpose of $\rho_{i}$ is to relate how much traffic each stake would provide to its nearest five temples. %should probably use just nearest 1, it makes more sense.

\begin{table}
\begin{tabular}{c | l}
Variable & Description\\
\hline
$d(s_i,t_j)$ & Distance from stake $s_i$ to temple $t_j$\\
$\rho_i$ & Density of stake $s_i$\\
$S$ & Set of all stakes\\
$s_i$ & Stake number $i$\\
$T$ & Set of all temples\\
$T_{\text{new}}$ & The proposed new temple locations\\
$t_i$ & Temple number $i$ \\
$\tau_i$ & Temple score of temple $t_i$\\
\end{tabular}
\caption{Important variables for the Markov model used to solve the LDS location problem.}
\end{table}

Next, for each stake, we assumed the number of members that attend the temple on an average day given the stake center's Euclidean distance (again determined by the Vincenty Algorithm) to and the busyness of its 5 closest temples.
% Insert mathematical formula or explanation of the code here.
We determined the busyness of a temple, $\tau_i$, based on the number of stakes that listed that temple as one of its five closest temples. %Didn't use busyness in most recent iteration of model
% Insert mathematical formula here.

In order to create this model, we initialize a square probability matrix $P$ in which the first $k$ rows and columns correspond to the stakes in the United States and the next $m$ rows and columns correspond to the temples in the United States.
Each $P_{ij}$ in the matrix represents the probability that a person in row $i$ will travel to column $j$ in the current state.
The diagonal entries $P_{ii}$ represent the probability that a person will remain in their current state (i.e. not visit a temple on a given day).
The time, in this case, is in days, so each multiplication of the transition matrix onto a distribution vector will simulate one day passing.

% Create a visual matrix representation of the matrix initialized | There's a version where the magnitude of the entry is color in No_Busyness_Test.ipynb

We begin populating the matrix by allowing the diagonals $P_{ii} = p + f(d)$ with $p$ = $29/30$ which numerically represents the assumption that in each state, $1/30$ of a stake's temple attendees will attend the temple in a given day (using f from $(1)$).
We follow the procedures outlined in section 3.2 to populate the remainder of the matrix.
%We then adjust this number according to $g(d)$ described in 
%To do so, we compute a measure of busyness by taking into account the number of stakes within a close proximity to each temple.
%The required numerical representations are described below.

%\begin{equation}
%\begin{aligned}
%Ts_j = \sqrt{1\over{\sum_j{t_{ij}}}}
%\end{aligned}
%\end{equation}

\subsection{Results}

This will be filled in soon, once we've run the final model on the case study data.
We will present the results of the case study, compare them to the results from the $P$-median problem, and discuss the advantages and disadvantages of using the Markov chain.
	% state the results of the case study

    % compare to Euclidean model

    	% advantages

        	% Easier customization and fine tune the results

            % clustering

        % disadvantages

        	% much more complex to implement

    % sensitivity testing

    	% not a smooth function (ellipses) - changing where new temples are located

\section{Conclusion}

Discrete mathematics is already in wide use in facility location theory. %citation needed
The development and discussion of methods based on Markov chains is another example of using tools from discrete mathematics to give researchers and decision makers more information.
A system modeled as a network via a Markov chain can be analyzed to optimize its throughput, connectedness, and many other mathematical properties, each with possible applications in the area of facility location theory.
According to the arguments given here and the computational evidence, there is strong reason to believe that the simplified qualitative interpretation of the metrics used to optimize a network indeed work as presented.

In the conclusion, we will also cover ideas for application and further work.

% What has been accomplished/shown in this paper

	% Ideas for further work
	% Clustering

  % Ideas for possible applications

  	% Utilities

    % Stores/consumers

    % supply chain management

\begin{thebibliography}{99}

\bibitem[Berman, Drezner, Wesolowsky, 2003]{Berman:2003}
Berman O, Drezner Z, Wesolowsky G.
\newblock Locating service facilities whose reliability is distance dependent.
\newblock {\em Computers \& Operations Research.} 2003; 30:1683-1695.

\bibitem[Bose, Maheshwari, Morin, 2003]{Bose:2003}
Bose P, Maheshwari A, Morin P.
\newblock Fast approximations for sums of distances, clustering and the Fermat-Weber problem.
\newblock {\em Computational Geometry.} 2003; 24:135-146.

\bibitem[Bruni, Beraldi, Conforti, 2016]{Bruni:2016}
Bruni M, Beraldi P, Conforti D.
\newblock Water distribution networks design under uncertainty.
\newblock {\em TOP.} 2016; 25:111-126.

\bibitem[Current, Min, Schilling, 1990]{Current:1990}
Current J, Min H, Schilling D.
\newblock Multiobjective analysis of facility location decisions.
\newblock {\em European Journal of Operational Research.} 1990; 49:295-307

\bibitem[Faizrahnemoon, Schlote, Maggi, Crisostomi, Shorten, 2015]{Faizrahnemoon:2015}
Faizrahnemoon M, Schlote A, Maggi L, Crisostomi E, Shorten R.
\newblock A big-data model for multi-modal public transportation with application to macroscopic control and optimisation.
\newblock {\em International Journal of Control.} 2015; 88:2354-2368.

\bibitem[Ghosh, Gosavi, 2017]{Ghosh:2017}
Ghosh S, Gosavi A.
\newblock A semi-Markov model for post-earthquake emergency response in a smart city.
\newblock {\em Control Theory and Technology.} 2017; 15: 13-25.

\bibitem[Jakubovskis, 2017]{Jakubovskis:2017}
Jakubovskis A.
\newblock Strategic facility location, capacity aquisition, and technology choice decisions under demand uncertainty: Robust vs. non-robust optimizations approaches.
\newblock {\em European Journal of Operational Research.} 2017; 260:1095-1104.

\bibitem[Kirkland, 2014]{Kirkland:2014}
Kirkland S.
\newblock Load balancing for Markov chains with a specified directed graph.
\newblock {\em Linear and Multilinear Algebra.} 2014; 62: 1491-1508.

\bibitem[Kirkland, Neumann, Sze, 2014]{Kirkland:2008}
Kirkland, S.J., Neumann, M. \& Sze, NS.
\newblock On Optimal Condition Numbers for Markov Chains
\newblock {\em Numer. Math.} 2008 110:521
%https://doi.org/10.1007/s00211-008-0172-8

\bibitem[Klose, Drexl, 2005]{Klose:2005}
Klose A, Drexl A.
\newblock Facility location models for distribution system design.
\newblock {\em European Journal of Operational Research} 2005; 162:4-29.

\bibitem[Krogh, Brown, Mian, Sjolander, Haussler, 1994]{Krogh:1994}
Krogh A, Brown M, Mian I S, Sjolander K, Haussler D.
\newblock Hidden Markov models in computational biology: applications to protein modeling.
\newblock {\em Journal of Molecular Biology.} 1994; 235:1501-1531.

\bibitem[Melo, Nickel, Saldanha-da-Gama, 2009]{Melo:2009}
Melo M, Nickel S, Saldanha-da-Gama F.
\newblock Facility location and supply-chain management - A review.
\newblock {\em European Journal of Operational Research.}  2009; 196:401-412.

\bibitem[Monson, 1995]{Monson:1995}
Monson T.
\newblock Blessings of the Temple. 1995;
\newblock Retrieved from https://www.lds.org/church/temples/why-we-build-temples/blessings-of-the-temple?lang=eng

\bibitem[Ndiaye, Ndiaye, Ly, 2012]{Ndiaye:2012}
Ndiaye F, Ndiaye B M, Ly I.
\newblock Application of the p-Median problem in School Allocation.
\newblock {\em American Journal of Operations Research.} 2012; 2:253-259.

\bibitem[Newman, 2003]{Newman:2003}
Newman M E J.
\newblock The structure and function of complex networks.
\newblock {\em SIAM REVIEW.} 2003; 45:167-256.

\bibitem[Owen, Daskin, 1998]{Owen:1998}
Owen S, Daskin M.
\newblock Strategic facility location: a review.
\newblock {\em European Journal of Operational Research.} 1998; 111:423-447.

\end{thebibliography}

\end{document}


%Could we use markov chains in advertisement analysis?  The assumption would be that the limiting factor for someone to purchase something is that they don't know, and we could change values in the transition matrix to model that?