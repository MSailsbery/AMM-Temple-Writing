\documentclass[twoside,twocolumn]{article}
\usepackage{blindtext}
\usepackage{amsmath}
\DeclareMathOperator*{\minimize}{minimize}
%\usepackage[T1]{fontenc}
\usepackage{microtype}
\usepackage[english]{babel}
\usepackage[hmarginratio=1:1,top=32mm,columnsep=20pt]{geometry}
\usepackage[hang, small,labelfont=bf,up,textfont=it,up]{caption}
\usepackage{booktabs}
\usepackage{lettrine}
\usepackage{enumitem}
\setlist[itemize]{noitemsep}
\usepackage{abstract}
\renewcommand{\abstractnamefont}{\normalfont\bfseries}
\renewcommand{\abstracttextfont}{\normalfont\small\itshape}
\usepackage{titlesec}
\renewcommand\thesection{\Roman{section}}
\renewcommand\thesubsection{\roman{subsection}}
\titleformat{\section}[block]{\large\scshape\centering}{\thesection.}{1em}{}
\titleformat{\subsection}[block]{\large}{\thesubsection.}{1em}{}
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhead{}
\fancyfoot{}
\fancyhead[C]{ FACILITY LOCATION USING MARKOV CHAINS $\bullet$ OCT 2017}
\fancyfoot[RO,LE]{\thepage}
\usepackage{titling}
\usepackage{hyperref}
\usepackage{tikz}
\usetikzlibrary{arrows}
\usepackage{graphicx}
\usepackage{amssymb}

\setlength{\droptitle}{-4\baselineskip}
\pretitle{\begin{center}\Huge\bfseries}
\posttitle{\end{center}}
\title{Facility Location Using Markov Chains}
\author{
\textsc{Applied Mathematical Modeling Research Team}\\[1ex]
\normalsize Brigham Young University \\
\normalsize \href{mailto:amm@math.byu.edu}{amm@math.byu.edu}
}
\date{\today}
\renewcommand{\maketitlehookd}{
\begin{abstract}
\noindent We consider using Markov chains to solve facility location problems.
We find that Markov chains, coupled with realistic assumptions, can find optimal facility locations defined in terms of four metrics.
Namely, the mean first passage time, consumer throughput, top-tier, and the Kemeny constant.
As a case study, we present a novel Markov chain construction that finds the optimal location for a new religious center of a Christian denomination.
\end{abstract}
}

% General Suggestions from Dr. Jarvis from several months ago:
%   - Use active voice wherever possible.
%   - Standardize citation method, put years next to the authors' names.

%%%%% In regards to above, I'm 99% sure that if an author's name is in a sentence it should not be in the in text notation, so please don't change my notation unless Dr. Jarvis is sure he wants it done that way. Thanks,  McKell %%%%%%%%%%%%%%

%   - Advertise for our methods --> hearken back to the new things that we're doing as often as possible.
%   - Standardize the language. (supplier/consumer or something)
%   - Remember that our audience wants to solve a problem, not do math.

% Big Ticket Items:
% There are several figures to be included
% The Literature Review section needs to finished/expanded, as well as double checked in its claims
% Some of the formulae in here are out of date
% The conclusion need to be expanded slightly
% Feel free to add more references in the text and bibliography, we are currently underreferencing

\begin{document}
\maketitle

\section{Introduction}

Problems in facility location theory focus on finding optimal locations for facilities to meet consumer demand, either by adding new facilities or relocating existing ones.
There are a myriad of ways to define an optimal location, but the standard definition is a location that minimizes the average distance traveled by a consumer to fulfill a demand (Owen \& Daskin, 1998).
Additional definitions of optimal include the location that minimizes the maximum distance traveled to fulfill a demand, the location to maximize consumer throughput, and the location that minimizes the average time consumers are required to travel to reach suppliers.
In this paper, we show that a Markov chain can be used to solve facility location problems based on these definitions of optimal.

A fundamental facility location problem is the $P$-median problem, which tries to minimize the distance that a consumer must travel to reach their nearest facility (Current, Min, \& Schilling, 1990).
Typical applications of $P$-median problems include finding optimal locations for industrial warehouses to minimize shipping distances (Jakubovskis, 2017), stores to maximize availability to customers (Klose, \& Drexl, 2005), and emergency response public services where response time is imperative (Ghosh, \& Gosavi, 2017).
As a special case of the $P$-median problem, we will be contrasting our methods with an approximate solution to the Fermat-Weber problem, the Weighted-Distance Model (WDM) (Bose, Maheshwari, \& Morin, 2003).
This solution seeks to minimize the average distance between consumers and a supplier.
An example of this model in application can be found in the paper by Ndiaye, Ndiaye and Ly (2012).

In comparison to the WDM, we use a Markov chain to model the behavior of consumers as they interact with facilities. 
Markov chains reveal the effects that simple local behaviors have on more complex global behaviors through modeling the behavior as a network.
This is similar to the goal of many facility location problems, as it is often the case that the behavior being optimized is about the aggregate populous and not the specific actions of certain individuals.
Markov chains have been used in many applications, including: mathematical ecology (Kirkland, 2014), computational biology (Krogh, Brown, Mian, Sjolander, \& Haussler, 1994), and network modeling (Newman, 2003), but they have not been commonly used in facility location problems.
In this paper, we show that Markov chains provide a flexible and efficient way to model facility location problems that offers additional information not found in the standard analysis of the $P$-median problem.

This paper proceeds as follows.
Section 2 contains a literary review of facility location problems, as well as literature pertaining to the WDM and the Markov chain method.
Section 3 will outline the construction of the Markov transition matrix used to solve facility location problems, give the results of the general testing of the model and expand on insights gained while studying the model.
Section 4 details the set up and results of our model to determine new locations for religious centers of a Christian denomination.
Section 5 will conclude the paper with suggestions for further work.

\section{Literature Review}

Facility location management is one of the most thoroughly-analyzed areas of operations research (Abin, 2016).
In fact, Current, Min and Schilling cite a recent bibliography on this subject that had over 1500 titles, showing the vast expanse of research in this area (1990).
Owen and Daskin, in their literature review, give an overview of the most-used models among this immense amount of literature.
They comment on 15 differing subsets of facility location problems, again demonstrating the vastness of the literature and applicability of the problem (1998).
Although the library of facility location management is large, this review will primarily focus on various approaches to median problems.
As we use Markov chains as an approach to median problems later, we will also review literature pertaining to traditional uses of Markov chains.

The study of location theory began in 1909 when Alfred Weber was researching possible warehouse locations based on the average distance to be traveled by those who would visit the warehouse (Owen \& Daskin, 1998).
His research created the basis for {\em median problems}, or problems that determine a facility location by minimizing the average distance traveled by consumers.
As noted by Melo, Nickel and Saldanha-da-Gamma, the $P$-median problem is considered to be the foundational median problem.
They define the $P$-median problem as the problem of placing $P$ facilities in locations that minimize the total weighted distance (or costs) to satisfy customer demands (2009).

From this rudimentary definition of a $P$-median problem arises a multitude of slight variations that account for the context of the problem.
For example, Berman, Drezner, and Wesolowsky use a model formulation which allows demands to be serviced by facilities other than the one closest to them (2003).
Bruni, Beraldi, and Conforti use an undirected graph to model a complex water distribution network (2016).
Lastly, Agra, Cerdeira, and Requejo decompose a large $P$-median problem into smaller $P$-median problems.
Once the optimal locations for each of these smaller problems are found, they are used to find a more globally optimal solution (2017).

$P$-median problems have been approached from the perspective of many different academic disciplines.
Example approaches have ranged from interval optimization (Yadav, Karmakar, Dikshit, \& Bhurjee, 2018), iterative goal programming (Karatas, \& Yakici, 2018), hyper heuristics with space reductions (Ren, Jiang, Xuan, \& Luo, 2010), to hybrid binary particle swarm optimization (Lin, \& Guan, 2018).
Typically, weighted-distance models (WDMs) involving Euclidean distance have been used (Francis, Lowe, Rayco, Tamir, 2009).
Other distances that can be used can be found in a paper by Bach (1981).

Many WDMs using Euclidean distance have had past successes.
Yang and Mei were able to create a sustainable agricultural development model for Zhenyuan County of Gansu province in China (2017).
Bargos, Lamas, Bargos, Neto, and Pardal found that the Euclidean WDM could accurately find optimal locations for sugarcane mills in Brazil (2016).
Lastly, Xie, Zhou, Xiao, Kulturel-Konak, and Konak used it as part of a hybrid model for real industrial applications (2018).

There are several disadvantages of the WDM.
For instance, Carling, Han, and Hakansson showed that in rural areas the model is sensitive to distance measure and spatial positioning of demand points (2012).
They also point out that in rural areas, the unit transportation cost will vary considerably, leading to unreliable weighted distance models.
Additionally, some weights (such as the ones that consider the attractiveness of facilities) can give unstable solutions (Carling, Han, Hakansson, \& Rebreyend, 2015).
Lastly, the WDM is also very computationally expensive, leading to consumers being grouped together (Carling, Han, Hakansson, 
\& Rebreyend, 2014). 
This practice of consolidating consumer populations has a significantly adverse effect on the final solution (Hillsman, \& Rhoda, 1978) (Zhao, \& Batta, 1999).

Due to the disadvantages of WDMs, we are interested in contrasting it with a Markov chain.
Markov chains stochastically model the transitioning of states in a closed system in discrete time, with the assumption that the state transition depends only on the current state (McMurtrey, Morgan, Pratt, \& Wirthlin, 2008).
They have been used in a variety of applications, including modeling contributions to online communities (Chen, Wei, Zhu, 2018), augmentation segmentation of infant cry signals (Naithani et al, 2018), and automatic detection of seismic events (Bhatti et al., 2016).
*** This section talked about hidden markov models, so the three examples given are for hidden markov models.  Is this OK or do we need to find some different applications of regular markov models? ***

In terms of applications to location theory, the literature is fairly sparse.
In their paper, Rosenthal, White and Young used a infinite-horizon Markov decision chain in location analysis.
In particular, they modeled the relocation of facilities as consumers dynamically relocate.
They used a Markov chain to model the dynamic relocation of consumers, but do not use it to determine the optimal location of demand-filling facilities (Rosenthal, 1978).

We aim to fill this gap in the literature by showing that Markov chains can be used to find the optimal location of facilities.
Whereas other models exists to find optimal locations, they often only consider one unit of measurement of ``optimal''.
For example, the WDM only considers the average distance to a facility of every customer.
A Voronoi diagram can find the maximum geographical area that a facility serves (Sugihara, 2008).
The Markov chain, in contrast, can take into consideration several different metrics.
We will specifically focus on the mean first passage time, throughput, Kemeny constant, and top-tier as discussed in Faizrahnemoon et al. in regards to detailing the access to a hospital by bus stops (2015).

\section{Markov Chain Modeling}

Various properties of a Markov Chains can determine optimal facility locations, each representing a different metric.
These properties used in tandem can optimize many different attributes of a supply network.
In this section, we develop the construction of the Markov chain, its properties and how they relate to various metrics.

\subsection{Background}

A Markov chain is an example of a stochastic simulation of a closed system with $n$ states in discrete time.
We create an $n\times n$ transition matrix $\textbf{X}$ where $\textbf{X}_{i, j}$ represents the probability of moving from state $i$ to state $j$ in one time step.
As this is a closed system, in each time step the probability that a person moves from state $i$ to some state in the system (including possibly remaining at $i$) is 1. 
Therefore, each row sums to one, making $\textbf{X}$ {\em row stochastic}.
\footnote{An equivalent construction could use a column stochastic transition matrix, but, without loss of generality, we continue with the row stochastic formulation here.}

One of the powerful applications of Markov chains is that we can easily derive an equilibrium solution, or steady state solution. 
We can model any initial condition (i.e. distribution of people) as a vector $\vec{\textbf{w}}_0$ and see the state of the system after one time step by taking $\vec{\textbf{w}}_1 = \vec{\textbf{w}}_0 \textbf{X}$.
More generally, we say $\vec{\textbf{w}}_{n + 1} = \vec{\textbf{w}}_n \textbf{X}$.
Thus, we can find the distribution of the system at any given time for any given starting distribution.
Because $\textbf{X}$ is row stochastic, the all ones vector is a right eigenvector.
As the matrix only contains probabilities in the range $[0, 1]$, we can add a small ``teleport'' factor everywhere so that $0 \prec \textbf{X} \prec 1$.
Therefore, by the Perron-Frobenius theorem, the dominant eigenvalue of $\textbf{X}$ is 1 and that it has an all-positive left eigenvector.
% We need to be more explicit with this. The PF theorem tells us that X has a simple eigenvalue equal to its spectral radius. So if we show the spectral radius is 1, then the dominant eigenvalue is 1. -McKell
This eigenvector is known as the Perron eigenvector and represents the steady state of the model. %citation
% Was someone wanting to site the bus paper? Because it uses different assumptions and conclusions, so I didn't find it appropriate to cite. -McKell
We use this steady state solution to observe the effect of a new facility on the distribution of consumers.
By altering the location of this proposed facility, we can find the optimal location for the new facility.

For a more in-depth background to Markov chain modeling please refer to the ``background" section of the paper by Faizrahnemoon et al. (2015).
The Markov chain model that we use is based on the model used in their paper.
It involves two stages: the initialization of $\textbf{X}$ and the computation of the metrics.

\subsection{The Transition Matrix}
\label{sec:model_setup}

% I took the below table out because I didn't think it added to our paper. We explain each variable as we use it, so it seems redundant, but I left it here in case someone wants to put it back in. But if you do, please keep it earlier in the Markov modeling section instead of later where it originally was, because the variables were already explained and used frequently before it showed up in the paper. - McKell
%\begin{table}
%\begin{tabular}{|c | p{5cm}|}
%\hline
%Variable & Description\\
%\hline
%$i$ & A consumer location \\
%$j$ & A supplier location \\
%$n$ & Number of states\\
%$k$ & Number of states corresponding to consumers\\
%$X$ & Transition matrix of the Markov Chain\\
%$\gamma$, $\alpha$, $\beta$  & Parameters for weighted distance function\\
%$p$ & Probability a consumer visits the supplier in one time step\\
%$d_{i}$ & Distance from consumer $i$ to the nearest supplier\\
%$e$ & Teleport factor \\
%\hline
%\end{tabular}
%\caption{Generic variables and parameters used in the setup of the Markov chain method.}
%\end{table}

Let the first $k$ rows and columns of $\textbf{X}$ correspond to consumer locations, where $k$ is the number of consumer locations.
The remaining columns and rows will correspond to the supplier locations as shown in Figure \ref{fig:block_diagram}.
We will now detail the process of finding $\textbf{X}_{i, j}$ for all $i$, $j$.

\begin{figure}
\[
\renewcommand{\arraystretch}{1.5}
\left[\begin{array}{@{}c|c@{}}
  CC &
  CS
\\ \hline
  SC
  & SS
\end{array}\right]
\]
\caption{A block diagram of the transition matrix \textbf{X}. 
$C$ represents a consumer location and $S$ a supplier location.
$CC$ corresponds to a person moving from one consumer location to another.
The other parts of the matrix follow similarly.
}
\label{fig:block_diagram}
\end{figure}

As Markov chains only consider aggregate behavior, assume that consumers do not transition from one consumer location to another (or from one supplier location to another, including staying at that location).
In other words, $\textbf{X}_{i, j} = 0$ for all $i, j$ such that $0 \leq i, j < k$  and $i \neq j$ or $k \leq i, j < n$.


Let $d_{i}$ be the distance from the consumer location $i$ to the nearest supplier location.
In order to define a region of significance, transform $d_i$ by a variant of the sigmoid function $\sigma(d_i): \mathbb{R} \rightarrow [0,1]$
\begin{equation}
\sigma(d_i) = \frac{1}{1 + e^{\gamma(d_i-\alpha)}} - \beta,
\end{equation}
where $\gamma$, $\alpha$, and $\beta$ represent, respectively, a stretch factor, a domain shift, and a range shift.
This transformation accounts for situations where consumers are located far or near enough away from a supplier location that reducing the distance  between the two locations would have a negligible effect on the probability of the consumer going to the supplier location.
If this region of significance does not hold significance for the modeler, a different transformation which best suits the situation should be chosen.

The values on the diagonal of $\textbf{X}$ represent the probability of a consumer not visiting a supplier in one time period.
Let $p$ be the probability that a consumer visits the nearest supplier facility 
on any given time step.
Thus, for $0 \leq i < k$, 
$$\textbf{X}_{i, i} = p + (1-p) \cdot g(d_{i}).$$
As is common with consumers, this formula makes the probability of a consumer not visiting a facility inversely proportional to the distance to that facility.
% Where does that equation come from??? Is it right? Do we consider the probability of a consumer going to only the nearest facility in this set up? Or are other supplier locations considered as well? Also, why do we multiply by distance? Wouldn't the probability already by in terms of distance? Or is the probability the same for every single consumer->location regardless of other factors? Our explanation is still a little vague- McKell

To consider movement from a consumer to a supplier, let
$$D_i = \sum_{k = j}^{n} \frac{1}{e^{d(i,j)}}$$
 where $d(i, j)$ is the distance between two locations.
The distance can be calculated in any way that is suitable for the situation.
The Euclidean distance can be used for ease of computation, but any other way of measuring distance between two points, such as arc length along the Earth or driving distance using Google Maps, would be appropriate in certain situations.
Then,
$$\textbf{X}_{i, j} = \textbf{X}_{i, i} \cdot \frac{\frac{1}{e^{d(i,j)}}}{D_i}$$
for all $0 \leq i < k$ and $k \leq j < n$.
% Where does this equation come from? And why do we use this instead of the variant of the sigmoid? -McKell

Now consider the movement from suppliers to consumers
$$\textbf{X}_{i, j} = \frac{(1 - \textbf{X}_{j, j})\cdot \textbf{X}_{j, i}}{E_i}$$
where 
$$E_i = \sum_{m=0}^{k} (1 - \textbf{X}_{m,m})\cdot \textbf{X}_{m, i}$$
and $k \leq i < n$ and $0 \leq j < k$.
% These equations come out of nowhere. I would appreciate an explanation of the intuition behind them and the justification of their correct usage. -McKell

This construction results in $\textbf{X}$ being a row stochastic matrix.
We can see this by fixing $i \leq k$ where k is the number of consumers.
Then 

\begin{align*}
\sum_{j=0}^n \textbf{X}_{i, j} &=  \textbf{X}_{i,i} + \sum_{j=k}^n (1 - \textbf{X}_{i, i}) \cdot \dfrac{\frac{1}{e^{d(i, j)}}}{\sum_{l=k}^n \frac{1}{e^{d(i, k)}}} \\
&= \textbf{X}_{i,i} + (1 - \textbf{X}_{i, i}) \sum_{j=k}^n  \dfrac{\frac{1}{e^{d(i, j)}}}{\sum_{l=k}^n \frac{1}{e^{d(i, k)}}} \\
&= \textbf{X}_{i,i} + (1 - \textbf{X}_{i, i}) \dfrac{\sum_{j=k}^n \frac{1}{e^{d(i, j)}}}{\sum_{l=k}^n \frac{1}{e^{d(i, k)}}} \\
&= \textbf{X}_{i,i} + (1 - \textbf{X}_{i, i}) \\
&= \textbf{X}_{i,i} + 1 - \textbf{X}_{i, i} \\
&= 1
\end{align*}

Thus, the first $k$ rows are stochastic.

To see that the remainder of the rows are stochastic, fix $i$ such that $ k < i \leq n$.  Then:

\begin{align*}
\sum_{j=0}^n \textbf{X}_{i, j} &= \sum_{j=0}^n \dfrac{(1-\textbf{X}_{j, j}) \cdot X_{j,i}}{\sum_{m=0}^k (1-\textbf{X}_{m, m}) \cdot \textbf{X}_{m, i}} \\
&= \dfrac{ \sum_{j=0}^n (1-\textbf{X}_{j, j}) \cdot \textbf{X}_{j,i}}{\sum_{m=0}^k (1-\textbf{X}_{m, m}) \cdot \textbf{X}_{m, i}} \\
&= \dfrac{ \sum_{j=0}^k (1-\textbf{X}_{j, j}) \cdot X_{j,i}}{\sum_{m=0}^k (1-\textbf{X}_{m, m}) \cdot \textbf{X}_{m, i}} \\
&= 1
\end{align*}

Where the third equality holds because $\textbf{X}_{j, i} = 0$ for $ k < j \leq n$
Thus, we see that $\textbf{X}$ is row stochastic.

To make $\textbf{X}$ a positive matrix, we add a ``teleport'' factor to each entry in $\textbf{X}$.
While this does not model true behavior, it ensures that the matrix satisfies the Perron-Frobenius theorem.
This is done as follows:

Given $e$, a small number greater than zero, let
$$\textbf{X}_{i,j} = (1-e) \textbf{X}_{i, j} + \frac{e}{n}$$
for all $i, j$.
This preserves the row stochastic nature of the matrix and ensures there is a positive value in every entry, therefore making the matrix ergodic.
We choose $e$ to be significantly smaller than any values in the transition matrix so the results are not influenced too greatly by the presence of the teleport factor.

\subsection{Proposed Metrics}
\label{sec:proposed_metrics}

As previously discussed, current facility location models only consider one metric to measure the optimality of a network.
In contrast, a Markov chain can consider several metrics.
In this section we will discuss four of these metrics, namely: mean first passage time, throughput, top-tier and the Kemeny constant.
We will refer to $\textbf{X}$ in blocks, as outlined in Figure \ref{fig:block_diagram}.

\subsubsection{Mean First Passage Time}

The mean first passage time represents the average time it takes to pass from one state to another.
This can be computed for every pair of states.
Many organizations care about increasing customer accessibility to their facilities, and optimizing on this metric will increase accessibility.

In block $CS$, the mean first passage time from $i$ to $j$ would represent the average time it takes for consumer at location $i$ to visit the supplier location $j$.
By minimizing the mean first passage time, we minimize the average amount of time it takes for a consumer to visit a supplier.
To measure an entire network, we use a function of the entries of the mean first passage time matrix.

This matrix is defined as in Kirkland et al. (2008),
$$ \textbf{M} = [\textbf{I} - \textbf{X}^{\#} + \textbf{J}_{n}\textbf{X}_{d}^{\#}]\mathbf{\Pi}^{-1}$$
where $\textbf{I}$ is the $n \times n$ identity matrix, $\textbf{X}^{\#}$ is the {\em group inverse} of $\textbf{X}$, $\textbf{J}_{n}$ is the $n \times n$ matrix of all ones, $\textbf{X}_{d}^{\#}$ is the $n \times n$ diagonal matrix whose diagonal entries are the corresponding diagonal entries of $\textbf{X}_{\#}$, and where $\mathbf{\Pi}$ is the diagonal matrix whose diagonal entries are the corresponding entries of the equilibrium state vector of the transition matrix (Kirkland, Neumann, Sze, 2008).%Although cited, this is copied pretty much word for word from the source.  Can we quote it?
 The group inverse is the unique $n \times n$ matrix that satisfies $\textbf{X}^{\#}\textbf{X}\textbf{X}^{\#} = \textbf{X}^{\#}$, $\textbf{X}\textbf{X}^{\#}\textbf{X} = \textbf{X}$, and $\textbf{X}\textbf{X}^{\#} = \textbf{X}^{\#}\textbf{X}$.
The $i, j$-th entry of $\textbf{X}^{\#}$ gives the average number of time steps required for a person starting in state $i$ to get to state $j$.
% Out of curiousity, why do we use the mean first passage time over the group inverse? Aren't they essentially the same thing, but one is much more computationally expensive than the other? Should we justify our choice? - McKell
% Also, how does one calculate the group inverse? And should we mention that in our paper? Or give a reference to information about it?

 $\textbf{X}^{\#}$ has the same block structure as Figure \ref{fig:block_diagram}.
In this paper, we are only concerned with the $CS$ block of this matrix.
However, under a different problem formulation, other blocks could give meaningful information.
As a consumer would typically only visit the facility closest to them, we are only concerned with the smallest value in each row of the $CS$ block.
Consequently, we want to minimize the sum of the minimum value of each row.
By optimizing $\textbf{M}$ on this metric, we reduce the overall difficulty of a consumer getting to a supplier location.

To use this metric, choose a set of new facility locations. 
To use this metric, choose a set of proposed facility locations.
For each location, add it to the existing network, and compute $\textbf{M}$.
Following this, sum the smallest entries in each row.
The optimal location from this set is the location that has the smallest row sum in M.

The optimal location will be determined by the location with the smallest sum.

\subsubsection{Throughput}

In order to increase revenues, a reasonable thing to maximize is the number of people that visit suppliers during each time step.
For example, a restaurant wants the most people to go through each location.
If there are more people at the store daily, then revenues will increase, which is likely a desirable behavior in the network.

Referencing the first Perron eigenvector again, we can see the steady state of the network. 
Each entry in the eigenvector gives the proportion of people in the in that state in the long term or equilibrium. 
By this construction, the last $n - k$ terms in the eigenvector correspond to the proportion of people who visit a supplier in a given day.
To maximize the number of people who visit the supplier, we maximize the sum of these last $n - k$ places in the eigenvector.
To carry this out, we take the proposed location for the new facility, calculate the transition matrix for the network with the proposed facility, and compute the first Perron eigenvector.
Then, we sum over the last $n - k$ entries in the vector.
In comparison to the mean first passage time, the optimization problem induced by this metric is throughput-centric.

\subsubsection{Top-tier}
It also may be of interest to enlarge a consumer base by focusing on increasing accessibility for those who are currently having the most difficulty getting to suppliers.
This would represent situations such as hospitals or fire stations that desire to minimize the difficulty for outliers to get to a supplier's location.
By doing this, the worst-case response time of the fire station will be decreased because the ability of outlier consumers to visit suppliers is increased.

In order to have the most benefit for the consumers that have the most difficulty getting to the suppliers, we again consider the first Perron eigenvector.
The consumer entries with the highest values in the equilibrium vector will have the highest proportion of people in that location at any given day.
In order to get their business, these consumers must be able to visit suppliers more easily, which corresponds to a reduction in their entry in the Perron eigenvector.
To do this, we compute the Perron eigenvector for the network before adding a new facility and note the states that have the highest values in the eigenvector.
We choose the top $L$\% to minimize, where $L$ varies based on the context of the problem being considered.
If $L$ is large, this metric turns into the throughput metric.
If $L$ is very small, then a few locations will dominate the decision-making process.
For example, if we choose only one location to reduce, then the logical thing to do would be to place a supplier right on that consumer's location.

By optimizing on this metric, we ensure that the people that have the most difficulty getting to a supplier will be benefited the most.

\subsubsection{Kemeny Constant}
The Kemeny constant is defined to be 
$$K = \sum_{\substack{\lambda \in \sigma(X) \\ \lambda \neq 1}} \frac{1}{1-\lambda}$$
Where $\sigma(X)$ is the spectrum of $X$ (get reference for cho and meyer 2001).
It measures the connectedness of a network.
By maximizing the Kemeny constant, the network becomes more connected; that is, it is easier to reach any state from any other state.
This would be useful in situations like warehouses and distribution centers, where it is important for there to be many links from warehouses to distribution centers to allow for flexible and optimized scheduling of transport of goods.

\section{Case Study}

In this section we present an example of a facility location problem, in which some, but not all, of the metrics discussed previously give valuable information. 
The example given here is that of The Church of Jesus Christ of Latter-Day Saints (the LDS church) building new temples.

For members of the LDS Church, temples are a facility of worship and visiting them is believed to be imperative in the process of gaining salvation.
In this problem, we assume that the LDS Church is attempting to satisfy one of two goals, either increasing the access that its members have to temples (Top-tier metric) or generating the highest attendance to its temples overall (Throughput metric).

As a control case, we use a $P$-median method to minimize the distance of each church member to their closest temple.
The distance is measured as a transformation of the geophysical distance, which is in turn calculated via Vincenty's Formulae. %Citation Needed
We will refer to the Vincenty distance by $d_{v}$. %explanation of vincenty's formula?
The transformation is given by:
\begin{equation*}
f(d_{v}) = \frac{1}{1+e^{-0.053*(d_{v} - 70)}} - 0.024
\end{equation*}

This is a special case of (1) with the constants $\gamma$, $\alpha$, and $\beta$ chosen to mimic the effect of a temple a certain distance away.
Here, the assumption is that the difference between having a temple 5 miles away and 10 miles away is marginal, as is the difference between having a temple 200 miles away and 400 miles away.
The assumption implies that the biggest impact will come from people who were previously about 90 miles away from a temple and are now 20 miles away.

In the LDS church, church members are grouped by geographical area.
Each grouping of members is called a stake, and a building of worship, called a stake center, is located within each stake.
For our model, instead of the residence of each individual member, we use the location of the stake center to calculate $d_{v}$.
Let each stake center be represented as $s_i$, each temple as $t_j$, the set of all the stake centers as $S$, the set of original temples as $T$, and the set of new temples as $T_{\text{new}}$.
An example representation of the setup of this problem with each stake being connected to its two closest temples can be found in Figure 1.
The average distance a given member of an LDS stake has to travel to get to their closest temple is

\begin{equation*}
	h(S,T) = \frac{1}{n} \sum_i \underset{j}{\text{min}}\{d(s_i,t_j)\}.
\end{equation*}
Thus, the unconstrained optimization problem can be written as

\begin{equation*}
\begin{aligned}
	\minimize_{T^*} h(S,T^*), \text{ where } T^* = T \cup T_{\text{new}}.
\end{aligned}
\end{equation*}

\begin{figure}[h!]
\centering
\begin{tikzpicture} [->, >=stealth' ,shorten >=1pt, auto,node distance=2.25cm,thick,main node/.style={circle,draw,font=\sffamily\Large\bfseries}]
\node[main node] (1) {$T_{1}$}; % Creates a node referred to as (1) with label T_1
\node[main node] (2) [below left of=1] {$S_{1}$}; % Creates the node and positions it
\node[main node] (3) [above right of=1] {$S_{5}$};
\node[main node] (4) [right of=1] {$S_{4}$};
\node[main node] (5) [below right of=1] {$S_{3}$};
\node[main node] (6) [right of=4] {$T_{2}$};
\node[main node] (7) [above of=6] {$S_{6}$};
\node[main node] (8) [below right of=5] {$T_{3}$};
\node[main node] (9) [below of=1] {$S_{2}$};
\node[main node] (10) [below of=6] {$S_{7}$};
\path[every node/.style={font=\sffamily\small}]
(2) edge node [right] {0.6} (1) % Adds an edge from node (2) to node (1) with the label of 0.6 on the right of the edge
(2) edge [bend right] node [left] {1.5} (8) % Adds a curved edge from node (2) to node (1) with the label of 1.5 on the left of the edge
(3) edge node[left] {0.4} (1)
(3) edge [bend left] node [right] {1.2} (6)
(4) edge node [above] {0.2} (1)
(4) edge node [above] {0.4} (6)
(5) edge node [right] {0.3} (1)
(5) edge node [right] {0.3} (8)
(7) edge node [right] {1.6} (1)
(7) edge node [right] {0.7} (6)
(9) edge node[right] {0.4} (1)
(9) edge node [above] {1.2} (8)
(10) edge node [right] {0.8} (6)
(10) edge node [above] {0.2} (8);
\end{tikzpicture}
\caption{A sample graph including $7$ stakes and $3$ temples. \textbf{Note}: Edges in this figure are a measure of distance, not a measure of probability. Not to scale.} % Maybe edges should correspond to probability?
\label{fig:M1}
\end{figure}

%To determine the cardinality of $T_{\text{new}}$ to use in our experiments, we performed stochastic gradient descent to see if building multiple temples at once would change where the new temple locations would be. %explanation
%We found that the US is spread out enough that determining the location of multiple temples at once is not significantly different than determining the temples' locations one at a time.
For ease of computation, we only considered $T_{\text{new}}$ with carnality 1;
That is, we assume only one temple is to be added at a time.

To minimize the objective function, we sampled the value of $h$ in the United States at one million evenly spaced points.
For the test case, we used the WDM as a comparison of what the $P$-median problem would yield.
\subsection{Weighted Distance Model Setup}

To fully understand the model, it is crucial to know what factors were considered relevant.
Chief among these factors is the distance $d(s_i,t_j)$ from a stake center to a temple. %standardize distance notation
% Do we need to add a reference for the Vincenty algorithm below?
This distance is measured using the Vincenty Algorithm in order to account for the shape of the earth and give accurate measurements based on latitude and longitude. %mentioned earlier, could be expanded upon there and deleted here (l. 319)
This is a naive Euclidean distance not based upon actual driving or walking distances.
Using an API to find all of these actual distances could be considered for increased accuracy in future work.

The only other relevant factor to the WDM was the weight associated with each distance, $\omega_i$. %put in delineation of variables.
For convenience, we set these weights to $1$ to get our initial result.
%In further implementations, individual weights can be manually adjusted to account for other factors (traffic, tolls, etc.).
As this is a standard $P$-median problem, the weights can be adjusted to account for additional factors, as desired.

The WDM is designed to minimize the average weighted distance a given member of a LDS stake has to travel to get to their closest temple.
As such, this model does not take into account the capacity of the temples, nor the relative accessibility of other temples, even if they are a similar distance away.
The only assumption made about the behavior of church members is that they desire to have a temple close to their stake center, and that they will only use the closest temple to them. %did we do the 5 closest temples here? Or do we need new data with the 1 closest?

\subsection{Markov Model Setup}

To solve this problem, we used the Markov chain model that can be found in Section 3 using the variables in Table 1.
To simplify this model a number of assumptions were made.
First, we assumed that every LDS stake in the United States has the same number of active, temple-going members contained within its boundaries.
This approximation, combined with the assumption that every stake center is located at the center of the stake, allowed us to estimate the member density of each stake, $\rho_i$.
The purpose of $\rho_{i}$ is to relate how much traffic each stake would provide to its nearest five temples. %should probably use just nearest 1, it makes more sense.

\begin{table}
\begin{tabular}{c | l}
Variable & Description\\
\hline
$d(s_i,t_j)$ & Distance from stake $s_i$ to temple $t_j$\\
$\rho_i$ & Density of stake $s_i$\\
$S$ & Set of all stakes\\
$s_i$ & Stake number $i$\\
$T$ & Set of all temples\\
$T_{\text{new}}$ & The proposed new temple locations\\
$t_i$ & Temple number $i$ \\
$\tau_i$ & Temple score of temple $t_i$\\
\end{tabular}
\caption{Important variables for the Markov model used to solve the LDS location problem.}
\end{table}

Next, for each stake, we assumed the number of members that attend the temple on an average day given the stake center's Euclidean distance (again determined by the Vincenty Algorithm) to and the busyness of its 5 closest temples.
% Insert mathematical formula or explanation of the code here.
We determined the busyness of a temple, $\tau_i$, based on the number of stakes that listed that temple as one of its five closest temples. %Didn't use busyness in most recent iteration of model
% Insert mathematical formula here.

In order to create this model, we initialize a square probability matrix $P$ in which the first $k$ rows and columns correspond to the stakes in the United States and the next $m$ rows and columns correspond to the temples in the United States.
Each $P_{i,j}$ in the matrix represents the probability that a person in row $i$ will travel to column $j$ in the current state.
The diagonal entries $P_{i,i}$ represent the probability that a person will remain in their current state (i.e. not visit a temple on a given day).
The time, in this case, is in days, so each multiplication of the transition matrix onto a distribution vector will simulate one day passing.

% Create a visual matrix representation of the matrix initialized | There's a version where the magnitude of the entry is color in No_Busyness_Test.ipynb

We begin populating the matrix by allowing the diagonals $P_{i,i} = p + f(d)$ with $p$ = $29/30$ which numerically represents the assumption that in each state, $1/30$ of a stake's temple attendees will attend the temple in a given day (using f from $(1)$).
We follow the procedures outlined in section 3.2 to populate the remainder of the matrix.
%We then adjust this number according to $g(d)$ described in 
%To do so, we compute a measure of busyness by taking into account the number of stakes within a close proximity to each temple.
%The required numerical representations are described below.

%\begin{equation}
%\begin{aligned}
%Ts_j = \sqrt{1\over{\sum_j{t_{i,j}}}}
%\end{aligned}
%\end{equation}

\subsection{Results}

This will be filled in soon, once we've run the final model on the case study data.
We will present the results of the case study, compare them to the results from the $P$-median problem, and discuss the advantages and disadvantages of using the Markov chain.
	% state the results of the case study

    % compare to Euclidean model

    	% advantages

        	% Easier customization and fine tune the results

            % clustering

        % disadvantages

        	% much more complex to implement

    % sensitivity testing

    	% not a smooth function (ellipses) - changing where new temples are located

\section{Conclusion}

Discrete mathematics is already in wide use in facility location theory. %citation needed
The development and discussion of methods based on Markov chains is another example of using tools from discrete mathematics to give researchers and decision makers more information.
A system modeled as a network via a Markov chain can be analyzed to optimize its throughput, connectedness, and many other mathematical properties, each with possible applications in the area of facility location theory.
According to the arguments given here and the computational evidence, there is strong reason to believe that the simplified qualitative interpretation of the metrics used to optimize a network indeed work as presented.

In the conclusion, we will also cover ideas for application and further work.

% What has been accomplished/shown in this paper

	% Ideas for further work
	% Clustering

  % Ideas for possible applications

  	% Utilities

An interaction could be a sale made, a visit to a retail location, or any other meaningful experience that a consumer would have with a supplier. %Include other "Meaningful experiences" in the further research section.

    % Stores/consumers

    % supply chain management

\begin{thebibliography}{99}

\bibitem[Abin, 2016]{Abin:2016}
Abin, Ahmad Ali.
\newblock Querying Beneficial Constraints Before Clustering Using Facility Location Analysis.
\newblock {\em IEEE Transactions on Cybernetics} 2016; 48: 312-323.

\bibitem[Agra et al., 2017]{Agra:2017}
Agra, Agostinho, et al.
\newblock A decomposition approach for the p-median problem on disconnected graphs.
\newblock{\em Computers \& Operations Research.} 2017; 86:79-85.

\bibitem[Bach, 1981]{Bach:1981}
Bach, L.
\newblock The Problem of Aggregation and Distance for Analyses of Accessibility and Access Opportunity in Location-Allocation Models.
\newblock {\em Environment and Planning A: Economy and Space} 1981; 13:955-978.

\bibitem[Bargos et al., 2016]{Bargos:2016}
Bargos, Fabiano Fernandes, et al.
\newblock Location problem method applied to sugar and ethanol mills location optimization.
\newblock {\em Renewable \& Sustainable Energy Reviews} 2016; 65:274-282.

\bibitem[Berman et al., 2003]{Berman:2003}
Berman, Oded, et al.
\newblock Locating service facilities whose reliability is distance dependent.
\newblock {\em Computers \& Operations Research.} 2003; 30:1683-1695.

\bibitem[Bhatti et al., 2016]{Bhatti:2016}
Bhatti, Sohail Masood, et al.
\newblock Automatic detection of volcano-seismic events by modeling state and event duration in hidden Markov models.
\newblock{\em Journal of Volcanology and Geothermal Research.} 2016; 324:134-143.

\bibitem[Bose et al., 2003]{Bose:2003}
Bose, Prosenjit, et al.
\newblock Fast approximations for sums of distances, clustering and the Fermat-Weber problem.
\newblock {\em Computational Geometry.} 2003; 24:135-146.

\bibitem[Bruni et al, 2016]{Bruni:2016}
Bruni, M. E., et al.
\newblock Water distribution networks design under uncertainty.
\newblock {\em TOP.} 2016; 25:111-126.

\bibitem[Carling et al, 2012]{Carling:2012}
Carling, Kenneth, et al.
\newblock Does Euclidean distance work well when the p-median model is applied in rural areas?
\newblock {\em Annals of Operations Research} 2012; 201:83-97.

\bibitem[Carling et al., 2014]{Carling:2014}
Carling, Kenneth, et al.
\newblock Distance measure and the p-median problem in rural areas.
\newblock {\em Annals of Operations Research} 2014: 226:89-99.

\bibitem[Carling et al., 2015]{Carling:2015}
Carling, Kenneth, et al.
\newblock Testing the gravity p-median model empirically.
\newblock {\em Operations Research Perspectives} 2015; 2:124-132.

\bibitem[Chen et al., 2018]{Chen:2018}
Chen, Wei, et al.
\newblock Engaging voluntary contributions in online communities: a Hidden Markov Model.
\newblock {\em Mis Quarterly.} 2018; 42: 83-100.

\bibitem[Current, Min, Schilling, 1990]{Current:1990}
Current J, Min H, Schilling D.
\newblock Multiobjective analysis of facility location decisions.
\newblock {\em European Journal of Operational Research.} 1990; 49:295-307

\bibitem[Faizrahnemoon, Schlote, Maggi, Crisostomi, Shorten, 2015]{Faizrahnemoon:2015}
Faizrahnemoon M, Schlote A, Maggi L, Crisostomi E, Shorten R.
\newblock A big-data model for multi-modal public transportation with application to macroscopic control and optimisation.
\newblock {\em International Journal of Control.} 2015; 88:2354-2368.

\bibitem[Francis, Lowe, Rayco, Tamir, 2009]{Francis:2009}
Francis R, Lowe T, Rayco M, Tamir A.
\newblock Aggregation error for location models: survey and analysis.
\newblock {\em Annals of Operations Research} 2009; 167:171-208.

\bibitem[Ghosh, Gosavi, 2017]{Ghosh:2017}
Ghosh S, Gosavi A.
\newblock A semi-Markov model for post-earthquake emergency response in a smart city.
\newblock {\em Control Theory and Technology} 2017; 15: 13-25.

\bibitem[Hillsman, Rhoda, 1978]{Hillsman:1978}
Hillsman E, Rhoda R.
\newblock Errors in measuring distances from populations to service others.
\newblock {\em The Annals of Regional Science} 1978; 12:74-88.

\bibitem[Jakubovskis, 2017]{Jakubovskis:2017}
Jakubovskis A.
\newblock Strategic facility location, capacity aquisition, and technology choice decisions under demand uncertainty: Robust vs. non-robust optimizations approaches.
\newblock {\em European Journal of Operational Research.} 2017; 260:1095-1104.

\bibitem[Karatas, Yakici, 2018]{Karatas:2018}
Karatas M, Yakici E.
\newblock An iterative solution approach to a multi-objective facility location problem.
\newblock {\em Applied Soft Computing} 2018; 62: 272-287.

\bibitem[Kirkland, 2014]{Kirkland:2014}
Kirkland S.
\newblock Load balancing for Markov chains with a specified directed graph.
\newblock {\em Linear and Multilinear Algebra.} 2014; 62: 1491-1508.

\bibitem[Kirkland, Neumann, Sze, 2008]{Kirkland:2008}
Kirkland, S.J., Neumann, M. \& Sze, NS.
\newblock On Optimal Condition Numbers for Markov Chains
\newblock {\em Numer. Math.} 2008 110:521

\bibitem[Klose, Drexl, 2005]{Klose:2005}
Klose A, Drexl A.
\newblock Facility location models for distribution system design.
\newblock {\em European Journal of Operational Research} 2005; 162:4-29.

\bibitem[Krogh, Brown, Mian, Sjolander, Haussler, 1994]{Krogh:1994}
Krogh A, Brown M, Mian I S, Sjolander K, Haussler D.
\newblock Hidden Markov models in computational biology: applications to protein modeling.
\newblock {\em Journal of Molecular Biology.} 1994; 235:1501-1531.

\bibitem[Lin, Guan, 2018]{Lin:2018}
Lin G, Guan J.
\newblock A hybrid binary particle swarm optimization for the obnoxious p-median problem.
\newblock {\em Information Sciences.} 2018; 425:1-17.

\bibitem[McMurtrey, Morgan, Pratt, Wirthlin, 2008]{McMurtrey:2008}
McMurtrey D, Morgan K, Pratt B, Wirthlin M.
\newblock Estimating TMR Reliability on FPGAs Using Markov Models.
\newblock {\em BYU ScholarsArchive: All Faculty Publications} 2008; 149

\bibitem[Melo, Nickel, Saldanha-da-Gama, 2009]{Melo:2009}
Melo M, Nickel S, Saldanha-da-Gama F.
\newblock Facility location and supply-chain management - A review.
\newblock {\em European Journal of Operational Research.}  2009; 196:401-412.

\bibitem[Naithani et al., 2018]{Naithani:2018}
Naithani G, Kivinummi J, Virtanen T, Tammela O, Peltola M, Leppanen J.
\newblock Automatic segmentation of infant cry signals using hidden Markov models.
\newblock {\em EURASIP Journal on Audio Speech \& Music Processing.} 2018; 1:1-14.

\bibitem[Ndiaye, Ndiaye, Ly, 2012]{Ndiaye:2012}
Ndiaye F, Ndiaye B M, Ly I.
\newblock Application of the p-Median problem in School Allocation.
\newblock {\em American Journal of Operations Research.} 2012; 2:253-259.

\bibitem[Newman, 2003]{Newman:2003}
Newman M E J.
\newblock The structure and function of complex networks.
\newblock {\em SIAM REVIEW.} 2003; 45:167-256.

\bibitem[Owen, Daskin, 1998]{Owen:1998}
Owen, Susan Hesse and Mark S. Daskin.
\newblock Strategic facility location: a review.
\newblock {\em European Journal of Operational Research.} 1998; 111:423-447.

\bibitem[Ren et al., 2010]{Ren:2010}
Ren, Zhilei, et al.
\newblock Ant Based Hyper Heuristics with Space Reduction: A Case Study of the p-Median Problem.
\newblock {\em Lecture Notes in Computer Science.} 2010; 6238:546-55.

\bibitem[Rosenthal et al, 1978]{Rosenthal:1978}
Rosental, Richard E., et al.
\newblock Stochastic decision processes in location analysis.
\newblock {\em Management Science} 1978; 24:645-653

\bibitem[Sugihara, 2008]{Sugihara:2008}
Sugihara, Kokichi.
\newblock Voronoi Diagrams in Facility Location.
\newblock {\em Encyclopedia of Optimization} 2008; 2009:4040-4045.

\bibitem[Xie et al., 2018]{Xie:2018}
Xie, Yue, et al.
\newblock A beta-accurate linearization method of Euclidean distance for the facility layout problem with heterogeneous distance metrics.
\newblock {\em European Journal of Operational Research} 2018; 265:26-38.

\bibitem[Yadav et al. 2018]{Yadav:2018}
Yadav, Vinay, et al.
\newblock Interval-valued facility location model: An appraisal of municipal solid waste management system.
\newblock {\em Journal of Cleaner Production.} 2018; 171:250-263.

\bibitem[Yang S, Mei X]{Yang:2017}
Yang, Shiqi and Xurong Mei.
\newblock A sustainable agricultural development assessment method and a case study in China based on euclidean distance theory.
\newblock {\em Journal of Clean Production.} 2017; 168:551-557.

\bibitem[Zhao, Batta, 1999]{Zhao:1999}
Zhao, Pweiwu, and Rajan Batta.
\newblock Theory and Methodology: Analysis of centroid aggregation for the Euclidean distance p-median problem.
\newblock {\em European Journal of Operational Research.} 199: 113:147-168.

\end{thebibliography}

\end{document}


%Could we use markov chains in advertisement analysis?  The assumption would be that the limiting factor for someone to purchase something is that they don't know, and we could change values in the transition matrix to model that?